{"version":3,"sources":["webpack:///./node_modules/chess.js/chess.js","webpack:///./src/app/chessboard/chessboard.component.html","webpack:///./src/app/chessboard/chessboard.component.scss","webpack:///./src/app/chessboard/chessboard.component.ts","webpack:///./src/app/chessboard/index.ts","webpack:///./src/app/chessboard/promotion.dialog.html","webpack:///./src/app/chessboard/promotion.dialog.scss","webpack:///./src/app/chessboard/promotion.dialog.ts","webpack:///./src/app/position/position.module.ts","webpack:///./src/app/position/position.page.html","webpack:///./src/app/position/position.page.scss","webpack:///./src/app/position/position.page.ts"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,+BAA+B;AAC/D;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB;;AAEhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,SAAS,4CAA4C;AACrD,SAAS,4CAA4C;AACrD,SAAS,4CAA4C;AACrD,SAAS,4CAA4C;AACrD;;AAEA;AACA,eAAe;AACf;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,mBAAmB,qBAAqB;AACxC;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,aAAa,wCAAwC;AACrD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc;AACd;;AAEA;AACA;AACA,cAAc;AACd;;AAEA;AACA;AACA,cAAc;AACd;;AAEA;AACA;AACA,cAAc;AACd;;AAEA;AACA;AACA,cAAc;AACd;;AAEA;AACA;AACA,cAAc;AACd;;AAEA;AACA;AACA;AACA,cAAc;AACd;;AAEA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;;AAEA,qBAAqB,oBAAoB;AACzC;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA,SAAS;AACT;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;;AAEA;AACA;AACA,kBAAkB;AAClB;;AAEA;AACA,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA,4BAA4B,iBAAiB;AAC7C;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,8CAA8C,eAAe;AAC7D,8CAA8C,eAAe;AAC7D,8CAA8C,eAAe;AAC7D,8CAA8C,eAAe;;AAE7D;AACA;AACA;;AAEA;AACA;;AAEA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,sBAAsB,qCAAqC;AAC3D;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,iBAAiB;AACjB;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,SAAS;AACvD;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB;;AAEvB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA,0BAA0B,cAAc;AACxC;AACA,qBAAqB,QAAQ,UAAU;;AAEvC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,OAAO;AAC1B;AACA;;AAEA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,OAAO;AACP,+DAA+D,SAAS;AACxE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,iBAAiB;AAC7C;AACA,qBAAqB,QAAQ,UAAU;;AAEvC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,iCAAiC,gBAAgB,OAAO;AACxD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,gBAAgB;AAC5C;AACA,qBAAqB,QAAQ,UAAU;;AAEvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BAA2B,aAAa;;AAExC;AACA;AACA,yDAAyD,aAAa;;AAEtE;AACA;AACA;AACA;AACA,qBAAqB,SAAS;AAC9B;AACA;AACA,qCAAqC,aAAa;AAClD;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,cAAc,uBAAuB;AACrC;AACA,iBAAiB,6BAA6B;AAC9C;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,wBAAwB;AACxB;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,6CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sBAAsB,aAAa;;AAEnC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,uCAAuC;AACvC;;AAEA;AACA,wBAAwB;AACxB,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,sBAAsB;AACtB;;;AAGA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,gCAAgC,eAAe;;AAE/C;AACA;AACA;;AAEA;AACA;AACA;;AAEA,uCAAuC,SAAS;AAChD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,4BAA4B,iBAAiB;AAC7C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gCAAgC,aAAa;AAC7C;AACA;;AAEA,uCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,eAAe,EAAE;AACjE;AACA;AACA;AACA,wCAAwC,iBAAiB;AACzD,iCAAiC,QAAQ,UAAU;AACnD;AACA;AACA;AACA,eAAe;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,8CAA8C,SAAS;;AAEvD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,uCAAuC,wCAAwC;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,kBAAkB;AACvC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,0BAA0B,GAAG,IAAI;;AAEjC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,6BAA6B,8BAA8B;AAC3D;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA,eAAe;AACf;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,OAAO;AACP;;AAEA;AACA,2CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI,IAA8B;AAClC;AACA,IAAI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","file":"position-position-module.js","sourcesContent":["/*\n * Copyright (c) 2016, Jeff Hlywa (jhlywa@gmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n *    this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n *\n *----------------------------------------------------------------------------*/\n\n/* minified license below  */\n\n/* @license\n * Copyright (c) 2016, Jeff Hlywa (jhlywa@gmail.com)\n * Released under the BSD license\n * https://github.com/jhlywa/chess.js/blob/master/LICENSE\n */\n\nvar Chess = function(fen) {\n\n  /* jshint indent: false */\n\n  var BLACK = 'b';\n  var WHITE = 'w';\n\n  var EMPTY = -1;\n\n  var PAWN = 'p';\n  var KNIGHT = 'n';\n  var BISHOP = 'b';\n  var ROOK = 'r';\n  var QUEEN = 'q';\n  var KING = 'k';\n\n  var SYMBOLS = 'pnbrqkPNBRQK';\n\n  var DEFAULT_POSITION = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n\n  var POSSIBLE_RESULTS = ['1-0', '0-1', '1/2-1/2', '*'];\n\n  var PAWN_OFFSETS = {\n    b: [16, 32, 17, 15],\n    w: [-16, -32, -17, -15]\n  };\n\n  var PIECE_OFFSETS = {\n    n: [-18, -33, -31, -14,  18, 33, 31,  14],\n    b: [-17, -15,  17,  15],\n    r: [-16,   1,  16,  -1],\n    q: [-17, -16, -15,   1,  17, 16, 15,  -1],\n    k: [-17, -16, -15,   1,  17, 16, 15,  -1]\n  };\n\n  var ATTACKS = [\n    20, 0, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0, 0,20, 0,\n     0,20, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0,20, 0, 0,\n     0, 0,20, 0, 0, 0, 0, 24,  0, 0, 0, 0,20, 0, 0, 0,\n     0, 0, 0,20, 0, 0, 0, 24,  0, 0, 0,20, 0, 0, 0, 0,\n     0, 0, 0, 0,20, 0, 0, 24,  0, 0,20, 0, 0, 0, 0, 0,\n     0, 0, 0, 0, 0,20, 2, 24,  2,20, 0, 0, 0, 0, 0, 0,\n     0, 0, 0, 0, 0, 2,53, 56, 53, 2, 0, 0, 0, 0, 0, 0,\n    24,24,24,24,24,24,56,  0, 56,24,24,24,24,24,24, 0,\n     0, 0, 0, 0, 0, 2,53, 56, 53, 2, 0, 0, 0, 0, 0, 0,\n     0, 0, 0, 0, 0,20, 2, 24,  2,20, 0, 0, 0, 0, 0, 0,\n     0, 0, 0, 0,20, 0, 0, 24,  0, 0,20, 0, 0, 0, 0, 0,\n     0, 0, 0,20, 0, 0, 0, 24,  0, 0, 0,20, 0, 0, 0, 0,\n     0, 0,20, 0, 0, 0, 0, 24,  0, 0, 0, 0,20, 0, 0, 0,\n     0,20, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0,20, 0, 0,\n    20, 0, 0, 0, 0, 0, 0, 24,  0, 0, 0, 0, 0, 0,20\n  ];\n\n  var RAYS = [\n     17,  0,  0,  0,  0,  0,  0, 16,  0,  0,  0,  0,  0,  0, 15, 0,\n      0, 17,  0,  0,  0,  0,  0, 16,  0,  0,  0,  0,  0, 15,  0, 0,\n      0,  0, 17,  0,  0,  0,  0, 16,  0,  0,  0,  0, 15,  0,  0, 0,\n      0,  0,  0, 17,  0,  0,  0, 16,  0,  0,  0, 15,  0,  0,  0, 0,\n      0,  0,  0,  0, 17,  0,  0, 16,  0,  0, 15,  0,  0,  0,  0, 0,\n      0,  0,  0,  0,  0, 17,  0, 16,  0, 15,  0,  0,  0,  0,  0, 0,\n      0,  0,  0,  0,  0,  0, 17, 16, 15,  0,  0,  0,  0,  0,  0, 0,\n      1,  1,  1,  1,  1,  1,  1,  0, -1, -1,  -1,-1, -1, -1, -1, 0,\n      0,  0,  0,  0,  0,  0,-15,-16,-17,  0,  0,  0,  0,  0,  0, 0,\n      0,  0,  0,  0,  0,-15,  0,-16,  0,-17,  0,  0,  0,  0,  0, 0,\n      0,  0,  0,  0,-15,  0,  0,-16,  0,  0,-17,  0,  0,  0,  0, 0,\n      0,  0,  0,-15,  0,  0,  0,-16,  0,  0,  0,-17,  0,  0,  0, 0,\n      0,  0,-15,  0,  0,  0,  0,-16,  0,  0,  0,  0,-17,  0,  0, 0,\n      0,-15,  0,  0,  0,  0,  0,-16,  0,  0,  0,  0,  0,-17,  0, 0,\n    -15,  0,  0,  0,  0,  0,  0,-16,  0,  0,  0,  0,  0,  0,-17\n  ];\n\n  var SHIFTS = { p: 0, n: 1, b: 2, r: 3, q: 4, k: 5 };\n\n  var FLAGS = {\n    NORMAL: 'n',\n    CAPTURE: 'c',\n    BIG_PAWN: 'b',\n    EP_CAPTURE: 'e',\n    PROMOTION: 'p',\n    KSIDE_CASTLE: 'k',\n    QSIDE_CASTLE: 'q'\n  };\n\n  var BITS = {\n    NORMAL: 1,\n    CAPTURE: 2,\n    BIG_PAWN: 4,\n    EP_CAPTURE: 8,\n    PROMOTION: 16,\n    KSIDE_CASTLE: 32,\n    QSIDE_CASTLE: 64\n  };\n\n  var RANK_1 = 7;\n  var RANK_2 = 6;\n  var RANK_3 = 5;\n  var RANK_4 = 4;\n  var RANK_5 = 3;\n  var RANK_6 = 2;\n  var RANK_7 = 1;\n  var RANK_8 = 0;\n\n  var SQUARES = {\n    a8:   0, b8:   1, c8:   2, d8:   3, e8:   4, f8:   5, g8:   6, h8:   7,\n    a7:  16, b7:  17, c7:  18, d7:  19, e7:  20, f7:  21, g7:  22, h7:  23,\n    a6:  32, b6:  33, c6:  34, d6:  35, e6:  36, f6:  37, g6:  38, h6:  39,\n    a5:  48, b5:  49, c5:  50, d5:  51, e5:  52, f5:  53, g5:  54, h5:  55,\n    a4:  64, b4:  65, c4:  66, d4:  67, e4:  68, f4:  69, g4:  70, h4:  71,\n    a3:  80, b3:  81, c3:  82, d3:  83, e3:  84, f3:  85, g3:  86, h3:  87,\n    a2:  96, b2:  97, c2:  98, d2:  99, e2: 100, f2: 101, g2: 102, h2: 103,\n    a1: 112, b1: 113, c1: 114, d1: 115, e1: 116, f1: 117, g1: 118, h1: 119\n  };\n\n  var ROOKS = {\n    w: [{square: SQUARES.a1, flag: BITS.QSIDE_CASTLE},\n        {square: SQUARES.h1, flag: BITS.KSIDE_CASTLE}],\n    b: [{square: SQUARES.a8, flag: BITS.QSIDE_CASTLE},\n        {square: SQUARES.h8, flag: BITS.KSIDE_CASTLE}]\n  };\n\n  var board = new Array(128);\n  var kings = {w: EMPTY, b: EMPTY};\n  var turn = WHITE;\n  var castling = {w: 0, b: 0};\n  var ep_square = EMPTY;\n  var half_moves = 0;\n  var move_number = 1;\n  var history = [];\n  var header = {};\n\n  /* if the user passes in a fen string, load it, else default to\n   * starting position\n   */\n  if (typeof fen === 'undefined') {\n    load(DEFAULT_POSITION);\n  } else {\n    load(fen);\n  }\n\n  function clear() {\n    board = new Array(128);\n    kings = {w: EMPTY, b: EMPTY};\n    turn = WHITE;\n    castling = {w: 0, b: 0};\n    ep_square = EMPTY;\n    half_moves = 0;\n    move_number = 1;\n    history = [];\n    header = {};\n    update_setup(generate_fen());\n  }\n\n  function reset() {\n    load(DEFAULT_POSITION);\n  }\n\n  function load(fen) {\n    var tokens = fen.split(/\\s+/);\n    var position = tokens[0];\n    var square = 0;\n\n    if (!validate_fen(fen).valid) {\n      return false;\n    }\n\n    clear();\n\n    for (var i = 0; i < position.length; i++) {\n      var piece = position.charAt(i);\n\n      if (piece === '/') {\n        square += 8;\n      } else if (is_digit(piece)) {\n        square += parseInt(piece, 10);\n      } else {\n        var color = (piece < 'a') ? WHITE : BLACK;\n        put({type: piece.toLowerCase(), color: color}, algebraic(square));\n        square++;\n      }\n    }\n\n    turn = tokens[1];\n\n    if (tokens[2].indexOf('K') > -1) {\n      castling.w |= BITS.KSIDE_CASTLE;\n    }\n    if (tokens[2].indexOf('Q') > -1) {\n      castling.w |= BITS.QSIDE_CASTLE;\n    }\n    if (tokens[2].indexOf('k') > -1) {\n      castling.b |= BITS.KSIDE_CASTLE;\n    }\n    if (tokens[2].indexOf('q') > -1) {\n      castling.b |= BITS.QSIDE_CASTLE;\n    }\n\n    ep_square = (tokens[3] === '-') ? EMPTY : SQUARES[tokens[3]];\n    half_moves = parseInt(tokens[4], 10);\n    move_number = parseInt(tokens[5], 10);\n\n    update_setup(generate_fen());\n\n    return true;\n  }\n\n  /* TODO: this function is pretty much crap - it validates structure but\n   * completely ignores content (e.g. doesn't verify that each side has a king)\n   * ... we should rewrite this, and ditch the silly error_number field while\n   * we're at it\n   */\n  function validate_fen(fen) {\n    var errors = {\n       0: 'No errors.',\n       1: 'FEN string must contain six space-delimited fields.',\n       2: '6th field (move number) must be a positive integer.',\n       3: '5th field (half move counter) must be a non-negative integer.',\n       4: '4th field (en-passant square) is invalid.',\n       5: '3rd field (castling availability) is invalid.',\n       6: '2nd field (side to move) is invalid.',\n       7: '1st field (piece positions) does not contain 8 \\'/\\'-delimited rows.',\n       8: '1st field (piece positions) is invalid [consecutive numbers].',\n       9: '1st field (piece positions) is invalid [invalid piece].',\n      10: '1st field (piece positions) is invalid [row too large].',\n      11: 'Illegal en-passant square',\n    };\n\n    /* 1st criterion: 6 space-seperated fields? */\n    var tokens = fen.split(/\\s+/);\n    if (tokens.length !== 6) {\n      return {valid: false, error_number: 1, error: errors[1]};\n    }\n\n    /* 2nd criterion: move number field is a integer value > 0? */\n    if (isNaN(tokens[5]) || (parseInt(tokens[5], 10) <= 0)) {\n      return {valid: false, error_number: 2, error: errors[2]};\n    }\n\n    /* 3rd criterion: half move counter is an integer >= 0? */\n    if (isNaN(tokens[4]) || (parseInt(tokens[4], 10) < 0)) {\n      return {valid: false, error_number: 3, error: errors[3]};\n    }\n\n    /* 4th criterion: 4th field is a valid e.p.-string? */\n    if (!/^(-|[abcdefgh][36])$/.test(tokens[3])) {\n      return {valid: false, error_number: 4, error: errors[4]};\n    }\n\n    /* 5th criterion: 3th field is a valid castle-string? */\n    if( !/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(tokens[2])) {\n      return {valid: false, error_number: 5, error: errors[5]};\n    }\n\n    /* 6th criterion: 2nd field is \"w\" (white) or \"b\" (black)? */\n    if (!/^(w|b)$/.test(tokens[1])) {\n      return {valid: false, error_number: 6, error: errors[6]};\n    }\n\n    /* 7th criterion: 1st field contains 8 rows? */\n    var rows = tokens[0].split('/');\n    if (rows.length !== 8) {\n      return {valid: false, error_number: 7, error: errors[7]};\n    }\n\n    /* 8th criterion: every row is valid? */\n    for (var i = 0; i < rows.length; i++) {\n      /* check for right sum of fields AND not two numbers in succession */\n      var sum_fields = 0;\n      var previous_was_number = false;\n\n      for (var k = 0; k < rows[i].length; k++) {\n        if (!isNaN(rows[i][k])) {\n          if (previous_was_number) {\n            return {valid: false, error_number: 8, error: errors[8]};\n          }\n          sum_fields += parseInt(rows[i][k], 10);\n          previous_was_number = true;\n        } else {\n          if (!/^[prnbqkPRNBQK]$/.test(rows[i][k])) {\n            return {valid: false, error_number: 9, error: errors[9]};\n          }\n          sum_fields += 1;\n          previous_was_number = false;\n        }\n      }\n      if (sum_fields !== 8) {\n        return {valid: false, error_number: 10, error: errors[10]};\n      }\n    }\n\n    if ((tokens[3][1] == '3' && tokens[1] == 'w') ||\n        (tokens[3][1] == '6' && tokens[1] == 'b')) {\n          return {valid: false, error_number: 11, error: errors[11]};\n    }\n\n    /* everything's okay! */\n    return {valid: true, error_number: 0, error: errors[0]};\n  }\n\n  function generate_fen() {\n    var empty = 0;\n    var fen = '';\n\n    for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\n      if (board[i] == null) {\n        empty++;\n      } else {\n        if (empty > 0) {\n          fen += empty;\n          empty = 0;\n        }\n        var color = board[i].color;\n        var piece = board[i].type;\n\n        fen += (color === WHITE) ?\n                 piece.toUpperCase() : piece.toLowerCase();\n      }\n\n      if ((i + 1) & 0x88) {\n        if (empty > 0) {\n          fen += empty;\n        }\n\n        if (i !== SQUARES.h1) {\n          fen += '/';\n        }\n\n        empty = 0;\n        i += 8;\n      }\n    }\n\n    var cflags = '';\n    if (castling[WHITE] & BITS.KSIDE_CASTLE) { cflags += 'K'; }\n    if (castling[WHITE] & BITS.QSIDE_CASTLE) { cflags += 'Q'; }\n    if (castling[BLACK] & BITS.KSIDE_CASTLE) { cflags += 'k'; }\n    if (castling[BLACK] & BITS.QSIDE_CASTLE) { cflags += 'q'; }\n\n    /* do we have an empty castling flag? */\n    cflags = cflags || '-';\n    var epflags = (ep_square === EMPTY) ? '-' : algebraic(ep_square);\n\n    return [fen, turn, cflags, epflags, half_moves, move_number].join(' ');\n  }\n\n  function set_header(args) {\n    for (var i = 0; i < args.length; i += 2) {\n      if (typeof args[i] === 'string' &&\n          typeof args[i + 1] === 'string') {\n        header[args[i]] = args[i + 1];\n      }\n    }\n    return header;\n  }\n\n  /* called when the initial board setup is changed with put() or remove().\n   * modifies the SetUp and FEN properties of the header object.  if the FEN is\n   * equal to the default position, the SetUp and FEN are deleted\n   * the setup is only updated if history.length is zero, ie moves haven't been\n   * made.\n   */\n  function update_setup(fen) {\n    if (history.length > 0) return;\n\n    if (fen !== DEFAULT_POSITION) {\n      header['SetUp'] = '1';\n      header['FEN'] = fen;\n    } else {\n      delete header['SetUp'];\n      delete header['FEN'];\n    }\n  }\n\n  function get(square) {\n    var piece = board[SQUARES[square]];\n    return (piece) ? {type: piece.type, color: piece.color} : null;\n  }\n\n  function put(piece, square) {\n    /* check for valid piece object */\n    if (!('type' in piece && 'color' in piece)) {\n      return false;\n    }\n\n    /* check for piece */\n    if (SYMBOLS.indexOf(piece.type.toLowerCase()) === -1) {\n      return false;\n    }\n\n    /* check for valid square */\n    if (!(square in SQUARES)) {\n      return false;\n    }\n\n    var sq = SQUARES[square];\n\n    /* don't let the user place more than one king */\n    if (piece.type == KING &&\n        !(kings[piece.color] == EMPTY || kings[piece.color] == sq)) {\n      return false;\n    }\n\n    board[sq] = {type: piece.type, color: piece.color};\n    if (piece.type === KING) {\n      kings[piece.color] = sq;\n    }\n\n    update_setup(generate_fen());\n\n    return true;\n  }\n\n  function remove(square) {\n    var piece = get(square);\n    board[SQUARES[square]] = null;\n    if (piece && piece.type === KING) {\n      kings[piece.color] = EMPTY;\n    }\n\n    update_setup(generate_fen());\n\n    return piece;\n  }\n\n  function build_move(board, from, to, flags, promotion) {\n    var move = {\n      color: turn,\n      from: from,\n      to: to,\n      flags: flags,\n      piece: board[from].type\n    };\n\n    if (promotion) {\n      move.flags |= BITS.PROMOTION;\n      move.promotion = promotion;\n    }\n\n    if (board[to]) {\n      move.captured = board[to].type;\n    } else if (flags & BITS.EP_CAPTURE) {\n        move.captured = PAWN;\n    }\n    return move;\n  }\n\n  function generate_moves(options) {\n    function add_move(board, moves, from, to, flags) {\n      /* if pawn promotion */\n      if (board[from].type === PAWN &&\n         (rank(to) === RANK_8 || rank(to) === RANK_1)) {\n          var pieces = [QUEEN, ROOK, BISHOP, KNIGHT];\n          for (var i = 0, len = pieces.length; i < len; i++) {\n            moves.push(build_move(board, from, to, flags, pieces[i]));\n          }\n      } else {\n       moves.push(build_move(board, from, to, flags));\n      }\n    }\n\n    var moves = [];\n    var us = turn;\n    var them = swap_color(us);\n    var second_rank = {b: RANK_7, w: RANK_2};\n\n    var first_sq = SQUARES.a8;\n    var last_sq = SQUARES.h1;\n    var single_square = false;\n\n    /* do we want legal moves? */\n    var legal = (typeof options !== 'undefined' && 'legal' in options) ?\n                options.legal : true;\n\n    /* are we generating moves for a single square? */\n    if (typeof options !== 'undefined' && 'square' in options) {\n      if (options.square in SQUARES) {\n        first_sq = last_sq = SQUARES[options.square];\n        single_square = true;\n      } else {\n        /* invalid square */\n        return [];\n      }\n    }\n\n    for (var i = first_sq; i <= last_sq; i++) {\n      /* did we run off the end of the board */\n      if (i & 0x88) { i += 7; continue; }\n\n      var piece = board[i];\n      if (piece == null || piece.color !== us) {\n        continue;\n      }\n\n      if (piece.type === PAWN) {\n        /* single square, non-capturing */\n        var square = i + PAWN_OFFSETS[us][0];\n        if (board[square] == null) {\n            add_move(board, moves, i, square, BITS.NORMAL);\n\n          /* double square */\n          var square = i + PAWN_OFFSETS[us][1];\n          if (second_rank[us] === rank(i) && board[square] == null) {\n            add_move(board, moves, i, square, BITS.BIG_PAWN);\n          }\n        }\n\n        /* pawn captures */\n        for (j = 2; j < 4; j++) {\n          var square = i + PAWN_OFFSETS[us][j];\n          if (square & 0x88) continue;\n\n          if (board[square] != null &&\n              board[square].color === them) {\n              add_move(board, moves, i, square, BITS.CAPTURE);\n          } else if (square === ep_square) {\n              add_move(board, moves, i, ep_square, BITS.EP_CAPTURE);\n          }\n        }\n      } else {\n        for (var j = 0, len = PIECE_OFFSETS[piece.type].length; j < len; j++) {\n          var offset = PIECE_OFFSETS[piece.type][j];\n          var square = i;\n\n          while (true) {\n            square += offset;\n            if (square & 0x88) break;\n\n            if (board[square] == null) {\n              add_move(board, moves, i, square, BITS.NORMAL);\n            } else {\n              if (board[square].color === us) break;\n              add_move(board, moves, i, square, BITS.CAPTURE);\n              break;\n            }\n\n            /* break, if knight or king */\n            if (piece.type === 'n' || piece.type === 'k') break;\n          }\n        }\n      }\n    }\n\n    /* check for castling if: a) we're generating all moves, or b) we're doing\n     * single square move generation on the king's square\n     */\n    if ((!single_square) || last_sq === kings[us]) {\n      /* king-side castling */\n      if (castling[us] & BITS.KSIDE_CASTLE) {\n        var castling_from = kings[us];\n        var castling_to = castling_from + 2;\n\n        if (board[castling_from + 1] == null &&\n            board[castling_to]       == null &&\n            !attacked(them, kings[us]) &&\n            !attacked(them, castling_from + 1) &&\n            !attacked(them, castling_to)) {\n          add_move(board, moves, kings[us] , castling_to,\n                   BITS.KSIDE_CASTLE);\n        }\n      }\n\n      /* queen-side castling */\n      if (castling[us] & BITS.QSIDE_CASTLE) {\n        var castling_from = kings[us];\n        var castling_to = castling_from - 2;\n\n        if (board[castling_from - 1] == null &&\n            board[castling_from - 2] == null &&\n            board[castling_from - 3] == null &&\n            !attacked(them, kings[us]) &&\n            !attacked(them, castling_from - 1) &&\n            !attacked(them, castling_to)) {\n          add_move(board, moves, kings[us], castling_to,\n                   BITS.QSIDE_CASTLE);\n        }\n      }\n    }\n\n    /* return all pseudo-legal moves (this includes moves that allow the king\n     * to be captured)\n     */\n    if (!legal) {\n      return moves;\n    }\n\n    /* filter out illegal moves */\n    var legal_moves = [];\n    for (var i = 0, len = moves.length; i < len; i++) {\n      make_move(moves[i]);\n      if (!king_attacked(us)) {\n        legal_moves.push(moves[i]);\n      }\n      undo_move();\n    }\n\n    return legal_moves;\n  }\n\n  /* convert a move from 0x88 coordinates to Standard Algebraic Notation\n   * (SAN)\n   *\n   * @param {boolean} sloppy Use the sloppy SAN generator to work around over\n   * disambiguation bugs in Fritz and Chessbase.  See below:\n   *\n   * r1bqkbnr/ppp2ppp/2n5/1B1pP3/4P3/8/PPPP2PP/RNBQK1NR b KQkq - 2 4\n   * 4. ... Nge7 is overly disambiguated because the knight on c6 is pinned\n   * 4. ... Ne7 is technically the valid SAN\n   */\n  function move_to_san(move, sloppy) {\n\n    var output = '';\n\n    if (move.flags & BITS.KSIDE_CASTLE) {\n      output = 'O-O';\n    } else if (move.flags & BITS.QSIDE_CASTLE) {\n      output = 'O-O-O';\n    } else {\n      var disambiguator = get_disambiguator(move, sloppy);\n\n      if (move.piece !== PAWN) {\n        output += move.piece.toUpperCase() + disambiguator;\n      }\n\n      if (move.flags & (BITS.CAPTURE | BITS.EP_CAPTURE)) {\n        if (move.piece === PAWN) {\n          output += algebraic(move.from)[0];\n        }\n        output += 'x';\n      }\n\n      output += algebraic(move.to);\n\n      if (move.flags & BITS.PROMOTION) {\n        output += '=' + move.promotion.toUpperCase();\n      }\n    }\n\n    make_move(move);\n    if (in_check()) {\n      if (in_checkmate()) {\n        output += '#';\n      } else {\n        output += '+';\n      }\n    }\n    undo_move();\n\n    return output;\n  }\n\n  // parses all of the decorators out of a SAN string\n  function stripped_san(move) {\n    return move.replace(/=/,'').replace(/[+#]?[?!]*$/,'');\n  }\n\n  function attacked(color, square) {\n    for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\n      /* did we run off the end of the board */\n      if (i & 0x88) { i += 7; continue; }\n\n      /* if empty square or wrong color */\n      if (board[i] == null || board[i].color !== color) continue;\n\n      var piece = board[i];\n      var difference = i - square;\n      var index = difference + 119;\n\n      if (ATTACKS[index] & (1 << SHIFTS[piece.type])) {\n        if (piece.type === PAWN) {\n          if (difference > 0) {\n            if (piece.color === WHITE) return true;\n          } else {\n            if (piece.color === BLACK) return true;\n          }\n          continue;\n        }\n\n        /* if the piece is a knight or a king */\n        if (piece.type === 'n' || piece.type === 'k') return true;\n\n        var offset = RAYS[index];\n        var j = i + offset;\n\n        var blocked = false;\n        while (j !== square) {\n          if (board[j] != null) { blocked = true; break; }\n          j += offset;\n        }\n\n        if (!blocked) return true;\n      }\n    }\n\n    return false;\n  }\n\n  function king_attacked(color) {\n    return attacked(swap_color(color), kings[color]);\n  }\n\n  function in_check() {\n    return king_attacked(turn);\n  }\n\n  function in_checkmate() {\n    return in_check() && generate_moves().length === 0;\n  }\n\n  function in_stalemate() {\n    return !in_check() && generate_moves().length === 0;\n  }\n\n  function insufficient_material() {\n    var pieces = {};\n    var bishops = [];\n    var num_pieces = 0;\n    var sq_color = 0;\n\n    for (var i = SQUARES.a8; i<= SQUARES.h1; i++) {\n      sq_color = (sq_color + 1) % 2;\n      if (i & 0x88) { i += 7; continue; }\n\n      var piece = board[i];\n      if (piece) {\n        pieces[piece.type] = (piece.type in pieces) ?\n                              pieces[piece.type] + 1 : 1;\n        if (piece.type === BISHOP) {\n          bishops.push(sq_color);\n        }\n        num_pieces++;\n      }\n    }\n\n    /* k vs. k */\n    if (num_pieces === 2) { return true; }\n\n    /* k vs. kn .... or .... k vs. kb */\n    else if (num_pieces === 3 && (pieces[BISHOP] === 1 ||\n                                 pieces[KNIGHT] === 1)) { return true; }\n\n    /* kb vs. kb where any number of bishops are all on the same color */\n    else if (num_pieces === pieces[BISHOP] + 2) {\n      var sum = 0;\n      var len = bishops.length;\n      for (var i = 0; i < len; i++) {\n        sum += bishops[i];\n      }\n      if (sum === 0 || sum === len) { return true; }\n    }\n\n    return false;\n  }\n\n  function in_threefold_repetition() {\n    /* TODO: while this function is fine for casual use, a better\n     * implementation would use a Zobrist key (instead of FEN). the\n     * Zobrist key would be maintained in the make_move/undo_move functions,\n     * avoiding the costly that we do below.\n     */\n    var moves = [];\n    var positions = {};\n    var repetition = false;\n\n    while (true) {\n      var move = undo_move();\n      if (!move) break;\n      moves.push(move);\n    }\n\n    while (true) {\n      /* remove the last two fields in the FEN string, they're not needed\n       * when checking for draw by rep */\n      var fen = generate_fen().split(' ').slice(0,4).join(' ');\n\n      /* has the position occurred three or move times */\n      positions[fen] = (fen in positions) ? positions[fen] + 1 : 1;\n      if (positions[fen] >= 3) {\n        repetition = true;\n      }\n\n      if (!moves.length) {\n        break;\n      }\n      make_move(moves.pop());\n    }\n\n    return repetition;\n  }\n\n  function push(move) {\n    history.push({\n      move: move,\n      kings: {b: kings.b, w: kings.w},\n      turn: turn,\n      castling: {b: castling.b, w: castling.w},\n      ep_square: ep_square,\n      half_moves: half_moves,\n      move_number: move_number\n    });\n  }\n\n  function make_move(move) {\n    var us = turn;\n    var them = swap_color(us);\n    push(move);\n\n    board[move.to] = board[move.from];\n    board[move.from] = null;\n\n    /* if ep capture, remove the captured pawn */\n    if (move.flags & BITS.EP_CAPTURE) {\n      if (turn === BLACK) {\n        board[move.to - 16] = null;\n      } else {\n        board[move.to + 16] = null;\n      }\n    }\n\n    /* if pawn promotion, replace with new piece */\n    if (move.flags & BITS.PROMOTION) {\n      board[move.to] = {type: move.promotion, color: us};\n    }\n\n    /* if we moved the king */\n    if (board[move.to].type === KING) {\n      kings[board[move.to].color] = move.to;\n\n      /* if we castled, move the rook next to the king */\n      if (move.flags & BITS.KSIDE_CASTLE) {\n        var castling_to = move.to - 1;\n        var castling_from = move.to + 1;\n        board[castling_to] = board[castling_from];\n        board[castling_from] = null;\n      } else if (move.flags & BITS.QSIDE_CASTLE) {\n        var castling_to = move.to + 1;\n        var castling_from = move.to - 2;\n        board[castling_to] = board[castling_from];\n        board[castling_from] = null;\n      }\n\n      /* turn off castling */\n      castling[us] = '';\n    }\n\n    /* turn off castling if we move a rook */\n    if (castling[us]) {\n      for (var i = 0, len = ROOKS[us].length; i < len; i++) {\n        if (move.from === ROOKS[us][i].square &&\n            castling[us] & ROOKS[us][i].flag) {\n          castling[us] ^= ROOKS[us][i].flag;\n          break;\n        }\n      }\n    }\n\n    /* turn off castling if we capture a rook */\n    if (castling[them]) {\n      for (var i = 0, len = ROOKS[them].length; i < len; i++) {\n        if (move.to === ROOKS[them][i].square &&\n            castling[them] & ROOKS[them][i].flag) {\n          castling[them] ^= ROOKS[them][i].flag;\n          break;\n        }\n      }\n    }\n\n    /* if big pawn move, update the en passant square */\n    if (move.flags & BITS.BIG_PAWN) {\n      if (turn === 'b') {\n        ep_square = move.to - 16;\n      } else {\n        ep_square = move.to + 16;\n      }\n    } else {\n      ep_square = EMPTY;\n    }\n\n    /* reset the 50 move counter if a pawn is moved or a piece is captured */\n    if (move.piece === PAWN) {\n      half_moves = 0;\n    } else if (move.flags & (BITS.CAPTURE | BITS.EP_CAPTURE)) {\n      half_moves = 0;\n    } else {\n      half_moves++;\n    }\n\n    if (turn === BLACK) {\n      move_number++;\n    }\n    turn = swap_color(turn);\n  }\n\n  function undo_move() {\n    var old = history.pop();\n    if (old == null) { return null; }\n\n    var move = old.move;\n    kings = old.kings;\n    turn = old.turn;\n    castling = old.castling;\n    ep_square = old.ep_square;\n    half_moves = old.half_moves;\n    move_number = old.move_number;\n\n    var us = turn;\n    var them = swap_color(turn);\n\n    board[move.from] = board[move.to];\n    board[move.from].type = move.piece;  // to undo any promotions\n    board[move.to] = null;\n\n    if (move.flags & BITS.CAPTURE) {\n      board[move.to] = {type: move.captured, color: them};\n    } else if (move.flags & BITS.EP_CAPTURE) {\n      var index;\n      if (us === BLACK) {\n        index = move.to - 16;\n      } else {\n        index = move.to + 16;\n      }\n      board[index] = {type: PAWN, color: them};\n    }\n\n\n    if (move.flags & (BITS.KSIDE_CASTLE | BITS.QSIDE_CASTLE)) {\n      var castling_to, castling_from;\n      if (move.flags & BITS.KSIDE_CASTLE) {\n        castling_to = move.to + 1;\n        castling_from = move.to - 1;\n      } else if (move.flags & BITS.QSIDE_CASTLE) {\n        castling_to = move.to - 2;\n        castling_from = move.to + 1;\n      }\n\n      board[castling_to] = board[castling_from];\n      board[castling_from] = null;\n    }\n\n    return move;\n  }\n\n  /* this function is used to uniquely identify ambiguous moves */\n  function get_disambiguator(move, sloppy) {\n    var moves = generate_moves({legal: !sloppy});\n\n    var from = move.from;\n    var to = move.to;\n    var piece = move.piece;\n\n    var ambiguities = 0;\n    var same_rank = 0;\n    var same_file = 0;\n\n    for (var i = 0, len = moves.length; i < len; i++) {\n      var ambig_from = moves[i].from;\n      var ambig_to = moves[i].to;\n      var ambig_piece = moves[i].piece;\n\n      /* if a move of the same piece type ends on the same to square, we'll\n       * need to add a disambiguator to the algebraic notation\n       */\n      if (piece === ambig_piece && from !== ambig_from && to === ambig_to) {\n        ambiguities++;\n\n        if (rank(from) === rank(ambig_from)) {\n          same_rank++;\n        }\n\n        if (file(from) === file(ambig_from)) {\n          same_file++;\n        }\n      }\n    }\n\n    if (ambiguities > 0) {\n      /* if there exists a similar moving piece on the same rank and file as\n       * the move in question, use the square as the disambiguator\n       */\n      if (same_rank > 0 && same_file > 0) {\n        return algebraic(from);\n      }\n      /* if the moving piece rests on the same file, use the rank symbol as the\n       * disambiguator\n       */\n      else if (same_file > 0) {\n        return algebraic(from).charAt(1);\n      }\n      /* else use the file symbol */\n      else {\n        return algebraic(from).charAt(0);\n      }\n    }\n\n    return '';\n  }\n\n  function ascii() {\n    var s = '   +------------------------+\\n';\n    for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\n      /* display the rank */\n      if (file(i) === 0) {\n        s += ' ' + '87654321'[rank(i)] + ' |';\n      }\n\n      /* empty piece */\n      if (board[i] == null) {\n        s += ' . ';\n      } else {\n        var piece = board[i].type;\n        var color = board[i].color;\n        var symbol = (color === WHITE) ?\n                     piece.toUpperCase() : piece.toLowerCase();\n        s += ' ' + symbol + ' ';\n      }\n\n      if ((i + 1) & 0x88) {\n        s += '|\\n';\n        i += 8;\n      }\n    }\n    s += '   +------------------------+\\n';\n    s += '     a  b  c  d  e  f  g  h\\n';\n\n    return s;\n  }\n\n  // convert a move from Standard Algebraic Notation (SAN) to 0x88 coordinates\n  function move_from_san(move, sloppy) {\n    // strip off any move decorations: e.g Nf3+?!\n    var clean_move = stripped_san(move);\n\n    // if we're using the sloppy parser run a regex to grab piece, to, and from\n    // this should parse invalid SAN like: Pe2-e4, Rc1c4, Qf3xf7\n    if (sloppy) {\n      var matches = clean_move.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);\n      if (matches) {\n        var piece = matches[1];\n        var from = matches[2];\n        var to = matches[3];\n        var promotion = matches[4];\n      }\n    }\n\n    var moves = generate_moves();\n    for (var i = 0, len = moves.length; i < len; i++) {\n      // try the strict parser first, then the sloppy parser if requested\n      // by the user\n      if ((clean_move === stripped_san(move_to_san(moves[i]))) ||\n          (sloppy && clean_move === stripped_san(move_to_san(moves[i], true)))) {\n        return moves[i];\n      } else {\n        if (matches &&\n            (!piece || piece.toLowerCase() == moves[i].piece) &&\n            SQUARES[from] == moves[i].from &&\n            SQUARES[to] == moves[i].to &&\n            (!promotion || promotion.toLowerCase() == moves[i].promotion)) {\n          return moves[i];\n        }\n      }\n    }\n\n    return null;\n  }\n\n\n  /*****************************************************************************\n   * UTILITY FUNCTIONS\n   ****************************************************************************/\n  function rank(i) {\n    return i >> 4;\n  }\n\n  function file(i) {\n    return i & 15;\n  }\n\n  function algebraic(i){\n    var f = file(i), r = rank(i);\n    return 'abcdefgh'.substring(f,f+1) + '87654321'.substring(r,r+1);\n  }\n\n  function swap_color(c) {\n    return c === WHITE ? BLACK : WHITE;\n  }\n\n  function is_digit(c) {\n    return '0123456789'.indexOf(c) !== -1;\n  }\n\n  /* pretty = external move object */\n  function make_pretty(ugly_move) {\n    var move = clone(ugly_move);\n    move.san = move_to_san(move, false);\n    move.to = algebraic(move.to);\n    move.from = algebraic(move.from);\n\n    var flags = '';\n\n    for (var flag in BITS) {\n      if (BITS[flag] & move.flags) {\n        flags += FLAGS[flag];\n      }\n    }\n    move.flags = flags;\n\n    return move;\n  }\n\n  function clone(obj) {\n    var dupe = (obj instanceof Array) ? [] : {};\n\n    for (var property in obj) {\n      if (typeof property === 'object') {\n        dupe[property] = clone(obj[property]);\n      } else {\n        dupe[property] = obj[property];\n      }\n    }\n\n    return dupe;\n  }\n\n  function trim(str) {\n    return str.replace(/^\\s+|\\s+$/g, '');\n  }\n\n  /*****************************************************************************\n   * DEBUGGING UTILITIES\n   ****************************************************************************/\n  function perft(depth) {\n    var moves = generate_moves({legal: false});\n    var nodes = 0;\n    var color = turn;\n\n    for (var i = 0, len = moves.length; i < len; i++) {\n      make_move(moves[i]);\n      if (!king_attacked(color)) {\n        if (depth - 1 > 0) {\n          var child_nodes = perft(depth - 1);\n          nodes += child_nodes;\n        } else {\n          nodes++;\n        }\n      }\n      undo_move();\n    }\n\n    return nodes;\n  }\n\n  return {\n    /***************************************************************************\n     * PUBLIC CONSTANTS (is there a better way to do this?)\n     **************************************************************************/\n    WHITE: WHITE,\n    BLACK: BLACK,\n    PAWN: PAWN,\n    KNIGHT: KNIGHT,\n    BISHOP: BISHOP,\n    ROOK: ROOK,\n    QUEEN: QUEEN,\n    KING: KING,\n    SQUARES: (function() {\n                /* from the ECMA-262 spec (section 12.6.4):\n                 * \"The mechanics of enumerating the properties ... is\n                 * implementation dependent\"\n                 * so: for (var sq in SQUARES) { keys.push(sq); } might not be\n                 * ordered correctly\n                 */\n                var keys = [];\n                for (var i = SQUARES.a8; i <= SQUARES.h1; i++) {\n                  if (i & 0x88) { i += 7; continue; }\n                  keys.push(algebraic(i));\n                }\n                return keys;\n              })(),\n    FLAGS: FLAGS,\n\n    /***************************************************************************\n     * PUBLIC API\n     **************************************************************************/\n    load: function(fen) {\n      return load(fen);\n    },\n\n    reset: function() {\n      return reset();\n    },\n\n    moves: function(options) {\n      /* The internal representation of a chess move is in 0x88 format, and\n       * not meant to be human-readable.  The code below converts the 0x88\n       * square coordinates to algebraic coordinates.  It also prunes an\n       * unnecessary move keys resulting from a verbose call.\n       */\n\n      var ugly_moves = generate_moves(options);\n      var moves = [];\n\n      for (var i = 0, len = ugly_moves.length; i < len; i++) {\n\n        /* does the user want a full move object (most likely not), or just\n         * SAN\n         */\n        if (typeof options !== 'undefined' && 'verbose' in options &&\n            options.verbose) {\n          moves.push(make_pretty(ugly_moves[i]));\n        } else {\n          moves.push(move_to_san(ugly_moves[i], false));\n        }\n      }\n\n      return moves;\n    },\n\n    in_check: function() {\n      return in_check();\n    },\n\n    in_checkmate: function() {\n      return in_checkmate();\n    },\n\n    in_stalemate: function() {\n      return in_stalemate();\n    },\n\n    in_draw: function() {\n      return half_moves >= 100 ||\n             in_stalemate() ||\n             insufficient_material() ||\n             in_threefold_repetition();\n    },\n\n    insufficient_material: function() {\n      return insufficient_material();\n    },\n\n    in_threefold_repetition: function() {\n      return in_threefold_repetition();\n    },\n\n    game_over: function() {\n      return half_moves >= 100 ||\n             in_checkmate() ||\n             in_stalemate() ||\n             insufficient_material() ||\n             in_threefold_repetition();\n    },\n\n    validate_fen: function(fen) {\n      return validate_fen(fen);\n    },\n\n    fen: function() {\n      return generate_fen();\n    },\n\n    pgn: function(options) {\n      /* using the specification from http://www.chessclub.com/help/PGN-spec\n       * example for html usage: .pgn({ max_width: 72, newline_char: \"<br />\" })\n       */\n      var newline = (typeof options === 'object' &&\n                     typeof options.newline_char === 'string') ?\n                     options.newline_char : '\\n';\n      var max_width = (typeof options === 'object' &&\n                       typeof options.max_width === 'number') ?\n                       options.max_width : 0;\n      var result = [];\n      var header_exists = false;\n\n      /* add the PGN header headerrmation */\n      for (var i in header) {\n        /* TODO: order of enumerated properties in header object is not\n         * guaranteed, see ECMA-262 spec (section 12.6.4)\n         */\n        result.push('[' + i + ' \\\"' + header[i] + '\\\"]' + newline);\n        header_exists = true;\n      }\n\n      if (header_exists && history.length) {\n        result.push(newline);\n      }\n\n      /* pop all of history onto reversed_history */\n      var reversed_history = [];\n      while (history.length > 0) {\n        reversed_history.push(undo_move());\n      }\n\n      var moves = [];\n      var move_string = '';\n\n      /* build the list of moves.  a move_string looks like: \"3. e3 e6\" */\n      while (reversed_history.length > 0) {\n        var move = reversed_history.pop();\n\n        /* if the position started with black to move, start PGN with 1. ... */\n        if (!history.length && move.color === 'b') {\n          move_string = move_number + '. ...';\n        } else if (move.color === 'w') {\n          /* store the previous generated move_string if we have one */\n          if (move_string.length) {\n            moves.push(move_string);\n          }\n          move_string = move_number + '.';\n        }\n\n        move_string = move_string + ' ' + move_to_san(move, false);\n        make_move(move);\n      }\n\n      /* are there any other leftover moves? */\n      if (move_string.length) {\n        moves.push(move_string);\n      }\n\n      /* is there a result? */\n      if (typeof header.Result !== 'undefined') {\n        moves.push(header.Result);\n      }\n\n      /* history should be back to what is was before we started generating PGN,\n       * so join together moves\n       */\n      if (max_width === 0) {\n        return result.join('') + moves.join(' ');\n      }\n\n      /* wrap the PGN output at max_width */\n      var current_width = 0;\n      for (var i = 0; i < moves.length; i++) {\n        /* if the current move will push past max_width */\n        if (current_width + moves[i].length > max_width && i !== 0) {\n\n          /* don't end the line with whitespace */\n          if (result[result.length - 1] === ' ') {\n            result.pop();\n          }\n\n          result.push(newline);\n          current_width = 0;\n        } else if (i !== 0) {\n          result.push(' ');\n          current_width++;\n        }\n        result.push(moves[i]);\n        current_width += moves[i].length;\n      }\n\n      return result.join('');\n    },\n\n    load_pgn: function(pgn, options) {\n      // allow the user to specify the sloppy move parser to work around over\n      // disambiguation bugs in Fritz and Chessbase\n      var sloppy = (typeof options !== 'undefined' && 'sloppy' in options) ?\n                    options.sloppy : false;\n\n      function mask(str) {\n        return str.replace(/\\\\/g, '\\\\');\n      }\n\n      function has_keys(object) {\n        for (var key in object) {\n          return true;\n        }\n        return false;\n      }\n\n      function parse_pgn_header(header, options) {\n        var newline_char = (typeof options === 'object' &&\n                            typeof options.newline_char === 'string') ?\n                            options.newline_char : '\\r?\\n';\n        var header_obj = {};\n        var headers = header.split(new RegExp(mask(newline_char)));\n        var key = '';\n        var value = '';\n\n        for (var i = 0; i < headers.length; i++) {\n          key = headers[i].replace(/^\\[([A-Z][A-Za-z]*)\\s.*\\]$/, '$1');\n          value = headers[i].replace(/^\\[[A-Za-z]+\\s\"(.*)\"\\]$/, '$1');\n          if (trim(key).length > 0) {\n            header_obj[key] = value;\n          }\n        }\n\n        return header_obj;\n      }\n\n      var newline_char = (typeof options === 'object' &&\n                          typeof options.newline_char === 'string') ?\n                          options.newline_char : '\\r?\\n';\n      var regex = new RegExp('^(\\\\[(.|' + mask(newline_char) + ')*\\\\])' +\n                             '(' + mask(newline_char) + ')*' +\n                             '1.(' + mask(newline_char) + '|.)*$', 'g');\n\n      /* get header part of the PGN file */\n      var header_string = pgn.replace(regex, '$1');\n\n      /* no info part given, begins with moves */\n      if (header_string[0] !== '[') {\n        header_string = '';\n      }\n\n      reset();\n\n      /* parse PGN header */\n      var headers = parse_pgn_header(header_string, options);\n      for (var key in headers) {\n        set_header([key, headers[key]]);\n      }\n\n      /* load the starting position indicated by [Setup '1'] and\n      * [FEN position] */\n      if (headers['SetUp'] === '1') {\n          if (!(('FEN' in headers) && load(headers['FEN']))) {\n            return false;\n          }\n      }\n\n      /* delete header to get the moves */\n      var ms = pgn.replace(header_string, '').replace(new RegExp(mask(newline_char), 'g'), ' ');\n\n      /* delete comments */\n      ms = ms.replace(/(\\{[^}]+\\})+?/g, '');\n\n      /* delete recursive annotation variations */\n      var rav_regex = /(\\([^\\(\\)]+\\))+?/g\n      while (rav_regex.test(ms)) {\n        ms = ms.replace(rav_regex, '');\n      }\n\n      /* delete move numbers */\n      ms = ms.replace(/\\d+\\.(\\.\\.)?/g, '');\n\n      /* delete ... indicating black to move */\n      ms = ms.replace(/\\.\\.\\./g, '');\n\n      /* delete numeric annotation glyphs */\n      ms = ms.replace(/\\$\\d+/g, '');\n\n      /* trim and get array of moves */\n      var moves = trim(ms).split(new RegExp(/\\s+/));\n\n      /* delete empty entries */\n      moves = moves.join(',').replace(/,,+/g, ',').split(',');\n      var move = '';\n\n      for (var half_move = 0; half_move < moves.length - 1; half_move++) {\n        move = move_from_san(moves[half_move], sloppy);\n\n        /* move not possible! (don't clear the board to examine to show the\n         * latest valid position)\n         */\n        if (move == null) {\n          return false;\n        } else {\n          make_move(move);\n        }\n      }\n\n      /* examine last move */\n      move = moves[moves.length - 1];\n      if (POSSIBLE_RESULTS.indexOf(move) > -1) {\n        if (has_keys(header) && typeof header.Result === 'undefined') {\n          set_header(['Result', move]);\n        }\n      }\n      else {\n        move = move_from_san(move, sloppy);\n        if (move == null) {\n          return false;\n        } else {\n          make_move(move);\n        }\n      }\n      return true;\n    },\n\n    header: function() {\n      return set_header(arguments);\n    },\n\n    ascii: function() {\n      return ascii();\n    },\n\n    turn: function() {\n      return turn;\n    },\n\n    move: function(move, options) {\n      /* The move function can be called with in the following parameters:\n       *\n       * .move('Nxb7')      <- where 'move' is a case-sensitive SAN string\n       *\n       * .move({ from: 'h7', <- where the 'move' is a move object (additional\n       *         to :'h8',      fields are ignored)\n       *         promotion: 'q',\n       *      })\n       */\n\n      // allow the user to specify the sloppy move parser to work around over\n      // disambiguation bugs in Fritz and Chessbase\n      var sloppy = (typeof options !== 'undefined' && 'sloppy' in options) ?\n                    options.sloppy : false;\n\n      var move_obj = null;\n\n      if (typeof move === 'string') {\n        move_obj = move_from_san(move, sloppy);\n      } else if (typeof move === 'object') {\n        var moves = generate_moves();\n\n        /* convert the pretty move object to an ugly move object */\n        for (var i = 0, len = moves.length; i < len; i++) {\n          if (move.from === algebraic(moves[i].from) &&\n              move.to === algebraic(moves[i].to) &&\n              (!('promotion' in moves[i]) ||\n              move.promotion === moves[i].promotion)) {\n            move_obj = moves[i];\n            break;\n          }\n        }\n      }\n\n      /* failed to find move */\n      if (!move_obj) {\n        return null;\n      }\n\n      /* need to make a copy of move because we can't generate SAN after the\n       * move is made\n       */\n      var pretty_move = make_pretty(move_obj);\n\n      make_move(move_obj);\n\n      return pretty_move;\n    },\n\n    undo: function() {\n      var move = undo_move();\n      return (move) ? make_pretty(move) : null;\n    },\n\n    clear: function() {\n      return clear();\n    },\n\n    put: function(piece, square) {\n      return put(piece, square);\n    },\n\n    get: function(square) {\n      return get(square);\n    },\n\n    remove: function(square) {\n      return remove(square);\n    },\n\n    perft: function(depth) {\n      return perft(depth);\n    },\n\n    square_color: function(square) {\n      if (square in SQUARES) {\n        var sq_0x88 = SQUARES[square];\n        return ((rank(sq_0x88) + file(sq_0x88)) % 2 === 0) ? 'light' : 'dark';\n      }\n\n      return null;\n    },\n\n    history: function(options) {\n      var reversed_history = [];\n      var move_history = [];\n      var verbose = (typeof options !== 'undefined' && 'verbose' in options &&\n                     options.verbose);\n\n      while (history.length > 0) {\n        reversed_history.push(undo_move());\n      }\n\n      while (reversed_history.length > 0) {\n        var move = reversed_history.pop();\n        if (verbose) {\n          move_history.push(make_pretty(move));\n        } else {\n          move_history.push(move_to_san(move));\n        }\n        make_move(move);\n      }\n\n      return move_history;\n    }\n\n  };\n};\n\n/* export Chess object if using node or any other CommonJS compatible\n * environment */\nif (typeof exports !== 'undefined') exports.Chess = Chess;\n/* export Chess object for any RequireJS compatible environment */\nif (typeof define !== 'undefined') define( function () { return Chess;  });\n","module.exports = \"<div id=\\\"__chessboard__\\\"></div>\"","module.exports = \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL2NoZXNzYm9hcmQvY2hlc3Nib2FyZC5jb21wb25lbnQuc2NzcyJ9 */\"","import { Component, HostListener, Output, EventEmitter, OnInit, OnDestroy } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { ModalController, Platform } from '@ionic/angular';\nimport { NativeAudio } from '@ionic-native/native-audio/ngx';\nimport { StockfishService } from '../shared';\nimport { Subscription } from 'rxjs';\nimport { PromotionDialog } from './promotion.dialog';\nimport * as Chess from 'chess.js';\nimport { TranslateService } from '@ngx-translate/core';\nimport { ConfigurationService, Configuration } from '../shared';\n\ndeclare var ChessBoard: any;\ndeclare var $: any;\n\n@Component({\n    selector: 'chessboard',\n    templateUrl: 'chessboard.component.html',\n    styleUrls: ['chessboard.component.scss'],\n})\nexport class ChessboardComponent implements OnInit, OnDestroy {\n\n    private configuration: Configuration;\n    private board: any;\n    private chess: Chess = new Chess();\n    private originalFen: string;\n    private fenHistory: string[];\n    private fenPointer: number;\n    private target: string;\n    private originalPlayer: string;\n    private player: string;\n    private autosolve = false;\n    private hinting = false;\n    private initializing = false;\n    private useSyzygy = false;\n    private squareSelected;\n    private onStockfishMessageSubscription: Subscription;\n    public literales: any;\n    private sounds = [];\n    private ooopsPlayed = false;\n\n    @Output() engineReady: EventEmitter<void> = new EventEmitter<void>();\n    @Output() engineStartThinking: EventEmitter<void> = new EventEmitter<void>();\n    @Output() engineEndThinking: EventEmitter<void> = new EventEmitter<void>();\n    @Output() engineInfo: EventEmitter<string> = new EventEmitter<string>();\n    @Output() playerMoved: EventEmitter<void> = new EventEmitter<void>();\n    @Output() gameOver: EventEmitter<string> = new EventEmitter<string>();\n\n    constructor(\n        private configurationService: ConfigurationService,\n        private stockfish: StockfishService,\n        public translate: TranslateService,\n        public modalController: ModalController,\n        private http: HttpClient,\n        private platform: Platform,\n        private nativeAudio: NativeAudio) { }\n\n    ngOnInit() {\n        this.onStockfishMessageSubscription = this.stockfish.onMessage$.subscribe(event => this.messageReceived(event));\n        this.loadAudio();\n        this.configurationService.initialize().then(config => {\n            this.configuration = config;\n            this.useSyzygy = this.configuration.useSyzygy;\n        });\n    }\n\n    ngOnDestroy() {\n        this.onStockfishMessageSubscription.unsubscribe();\n        this.unloadAudio();\n    }\n\n    private loadAudio() {\n        if (this.platform.is('cordova')) {\n            this.nativeAudio.preloadSimple('move', 'assets/audio/move.mp3');\n            this.nativeAudio.preloadSimple('success', 'assets/audio/success.mp3');\n            this.nativeAudio.preloadSimple('fail', 'assets/audio/fail.mp3');\n        } else {\n            let audio = new Audio();\n            audio.src = '/assets/audio/move.mp3';\n            audio.preload = 'auto';\n            this.sounds.push({key: 'move', audio: audio});\n            audio = new Audio();\n            audio.src = '/assets/audio/success.mp3';\n            audio.preload = 'auto';\n            this.sounds.push({key: 'success', audio: audio});\n            audio = new Audio();\n            audio.src = '/assets/audio/fail.mp3';\n            audio.preload = 'auto';\n            this.sounds.push({key: 'fail', audio: audio});\n        }\n    }\n\n    private unloadAudio() {\n        if (this.platform.is('cordova')) {\n            this.nativeAudio.unload('move');\n            this.nativeAudio.unload('success');\n            this.nativeAudio.unload('fail');\n        } else {\n            this.sounds.forEach(sound => {\n                sound.audio.src = '';\n                sound.audio.load();\n            });\n            this.sounds = [];\n        }\n    }\n\n    private playAudio(sound) {\n        if (this.platform.is('cordova')) {\n            this.nativeAudio.play(sound);\n        } else {\n            const soundToPlay = this.sounds.find((item) => { return item.key === sound; });\n            soundToPlay.audio.play();\n        }\n    }\n\n    @HostListener('window:resize', ['$event']) onResize(event) {\n        if (this.board) this.board.resize(event);\n    }\n\n    build(fen: string, target) {\n        const self = this;\n        this.initializing = true;\n        this.target = target;\n        this.autosolve = false;\n        this.originalFen = fen;\n        this.fenHistory = [fen];\n        this.ooopsPlayed = false;\n        if (this.board) {\n            this.board.destroy();\n        }\n        this.board = ChessBoard('__chessboard__', {\n            position: fen,\n            pieceTheme: '/assets/icon/{piece}.png',\n            draggable: true,\n            onDragStart: function (source, piece, position, orientation) { return self.onDragStart(source, piece, position, orientation); },\n            onDrop: function (source, target, piece, newPos, oldPos, orientation) { return self.onDrop(source, target, piece, newPos, oldPos, orientation); },\n            onMoveEnd: function (source, target) { self.onMoveEnd(source, target); },\n            onMouseoutSquare: function (square, piece, position, orientation) { self.onMouseoutSquare(square, piece, position, orientation); },\n            onMouseoverSquare: function (square, piece, position, orientation) { self.onMouseoverSquare(square, piece, position, orientation); },\n            onSnapEnd: function (source, target, piece) { self.onSnapEnd(source, target, piece); }\n        });\n        this.chess.load(fen);\n        this.cleanHighlights();\n        this.originalPlayer = this.chess.turn();\n        this.player = this.originalPlayer;\n        this.translate.get([\n            'chessboard.stalemate',\n            'chessboard.insufficent-material',\n            'chessboard.three-repetition',\n            'chessboard.rule-fifty',\n            'chessboard.game-over',\n            'chessboard.mate-in',\n            'chessboard.receive-mate-in',\n            'chessboard.unfeasible-mate',\n            'chessboard.white-advantage',\n            'chessboard.black-advantage',\n            'chessboard.querying-syzygy',\n            'chessboard.syzygy-error'\n        ]).subscribe(async res => {\n            this.literales = res;\n        });\n        window.setTimeout(function () { window.dispatchEvent(new Event('resize')); }, 100);\n    }\n\n    rewind() {\n        this.cleanHighlights();\n        this.board.position(this.originalFen);\n        this.chess.load(this.originalFen);\n        this.fenHistory = [this.originalFen];\n        this.player = this.chess.turn();\n        this.ooopsPlayed = false;\n    }\n\n    undo() {\n        this.cleanHighlights();\n        this.chess.undo();\n        this.chess.undo();\n        this.fenHistory.pop();\n        this.fenHistory.pop();\n        this.board.position(this.chess.fen());\n        this.ooopsPlayed = false;\n    }\n\n    history() {\n        return this.chess.history();\n    }\n\n    solve() {\n        this.initializing = false;\n        this.autosolve = true;\n        if (this.player === 'w') {\n            this.player = 'b';\n        } else {\n            this.player = 'w';\n        }\n        this.prepareMove();\n    }\n\n    hint() {\n        this.initializing = false;\n        this.hinting = true;\n        this.getEngineMove();\n        this.engineStartThinking.emit();\n    }\n\n    flip() {\n        this.board.flip();\n    }\n\n    stop() {\n        if (this.autosolve) {\n            this.autosolve = false;\n        }\n        this.stockfish.postMessage('stop');\n    }\n\n    winner() {\n        if (this.chess.in_checkmate()) {\n            return (this.chess.turn() === 'w' ? 'black' : 'white');\n        } else {\n            return null;\n        }\n    }\n\n    showFirstPosition() {\n        if (this.fenPointer === 0) {\n            return;\n        }\n        this.fenPointer = 0;\n        this.showFenPointer();\n    }\n\n    showPreviousPosition() {\n        if (this.fenPointer === 0) {\n            return;\n        }\n        this.fenPointer--;\n        this.showFenPointer();\n    }\n\n    showNextPosition() {\n        if (this.fenPointer === this.fenHistory.length - 1) {\n            return;\n        }\n        this.fenPointer++;\n        this.showFenPointer();\n    }\n\n    showLatestPosition() {\n        if (this.fenPointer === this.fenHistory.length - 1) {\n            return;\n        }\n        this.fenPointer = this.fenHistory.length - 1;\n        this.showFenPointer();\n    }\n\n    isShowingFirstPosition() {\n        return (this.fenPointer === 0);\n    }\n\n    isShowingLatestPosition() {\n        return (this.fenPointer === this.fenHistory.length - 1);\n    }\n    private showFenPointer() {\n        this.cleanHighlights();\n        if (this.configuration.playSounds) {\n            this.playAudio('move');\n        }\n        this.board.position(this.fenHistory[this.fenPointer], true);\n    }\n\n    private messageReceived(message) {\n        if (this.initializing) {\n            return;\n        }\n        if ('uciok' === message) {\n            this.engineReady.emit();\n            return;\n        }\n        let match;\n        if (match = message.match(/^bestmove ([a-h][1-8])([a-h][1-8])([qrbn])?/)) {\n            if (this.hinting) {\n                this.showHint(match[1], match[2], match[3], 2);\n                return;\n            }\n            this.chess.move({ from: match[1], to: match[2], promotion: match[3] });\n            if (this.configuration.playSounds) {\n                this.playAudio('move');\n            }\n            this.board.position(this.chess.fen(), false);\n            if (this.originalPlayer !== this.player) {\n                this.playerMoved.emit();\n            }\n            this.fenHistory.push(this.chess.fen());\n            this.highlightSquares(match[1], match[2]);\n            if (this.chess.game_over()) {\n                let message;\n                if (this.chess.in_checkmate())\n                    message = 'Checkmate';\n                else if (this.chess.in_stalemate())\n                    message = this.literales['chessboard.stalemate'];\n                else if (this.chess.insufficient_material())\n                    message = this.literales['chessboard.insufficent-material'];\n                else if (this.chess.in_threefold_repetition())\n                    message = this.literales['chessboard.three-repetition'];\n                else if (this.chess.in_draw())\n                    message = this.literales['chessboard.rule-fifty'];\n                else\n                    message = this.literales['chessboard.game-over'];\n                this.autosolve = false;\n                this.fenPointer = this.fenHistory.length - 1;\n                if (this.configuration.playSounds) {\n                    if ('checkmate' !== this.target && !this.chess.in_checkmate() ||\n                        'checkmate' === this.target && this.chess.in_checkmate() && this.originalPlayer !== this.chess.turn()) {\n                        this.playAudio('success');\n                    } else {\n                        this.playAudio('fail');\n                    }\n                }\n                this.gameOver.emit(message);\n                return;\n            }\n            if (this.autosolve || this.player !== this.originalPlayer) {\n                if (this.player === 'w') {\n                    this.player = 'b';\n                } else {\n                    this.player = 'w';\n                }\n                this.prepareMove();\n            } else {\n                if (this.squareSelected) {\n                    document.querySelector('.square-' + this.squareSelected).classList.add('highlight-square');\n                }\n                this.engineEndThinking.emit();\n            }\n        } else if (match = message.match(/^info .*\\bscore (\\w+) (-?\\d+)/)) {\n            const score = parseInt(match[2]) * (this.chess.turn() == 'w' ? 1 : -1);\n            let engineScore;\n            /// Is it measuring in centipawns?\n            if (match[1] == 'cp') {\n                engineScore = (score / 100.0).toFixed(2);\n                /// Did it find a mate?\n            } else if (match[1] == 'mate') {\n                if (this.originalPlayer === 'w' && score > 0 || this.originalPlayer === 'b' && score < 0) {\n                    this.engineInfo.emit(this.literales['chessboard.mate-in'] + ' ' + Math.abs(score));\n                } else {\n                    if (this.configuration.playSounds && !this.ooopsPlayed && !this.autosolve) {\n                        this.ooopsPlayed = true;\n                        this.playAudio('fail');\n                    }\n                    this.engineInfo.emit(this.literales['chessboard.receive-mate-in']);\n                }\n                return;\n            }\n            /// Is the score bounded?\n            let bound = '';\n            if (match = message.match(/\\b(upper|lower)bound\\b/)) {\n                bound = ((match[1] == 'upper') == (this.chess.turn() == 'w') ? '<= ' : '>= ');\n            }\n            if ('0.00' === engineScore) {\n                if ('checkmate' === this.target && this.configuration.playSounds && !this.ooopsPlayed && !this.autosolve) {\n                    this.ooopsPlayed = true;\n                    this.playAudio('fail');\n                }\n                this.engineInfo.emit(this.literales['chessboard.unfeasible-mate']);\n            } else if (parseFloat(engineScore) > 0) {\n                this.engineInfo.emit(this.literales['chessboard.white-advantage'] + ': ' + bound + engineScore);\n            } else {\n                this.engineInfo.emit(this.literales['chessboard.black-advantage'] + ': ' + bound + engineScore);\n            }\n        } else if (match = message.match(/^info .*\\bdepth (\\d+) .*\\bnps (\\d+)/)) {\n            this.engineInfo.emit('Depth: ' + match[1] + ' Nps: ' + match[2]);\n        }\n    }\n\n    private async promoteDialog(): Promise<string> {\n        return new Promise<string>(async resolve => {\n            const modal = await this.modalController.create({\n                component: PromotionDialog,\n                componentProps: { turn: this.originalPlayer }\n            });\n            modal.present();\n            const { data } = await modal.onDidDismiss();\n            if (data == undefined) {\n                resolve(null);\n            } else {\n                resolve(data.piece);\n            }\n        });\n    }\n\n    private onDragStart(source, piece, position, orientation) {\n        const re = this.player == 'w' ? /^b/ : /^w/;\n        if (this.chess.game_over() || piece.search(re) !== -1 || this.chess.turn() !== this.player) {\n            return false;\n        }\n        this.drawGreySquares(source);\n    };\n\n    private onDrop(source, target, piece, newPos, oldPos, orientation) {\n        this.removeGreySquares();\n        if (source == target) {\n            this.squareSelected = source;\n            this.drawGreySquares(source);\n            return;\n        }\n        // validate move\n        const move = this.chess.move({\n            from: source,\n            to: target,\n            promotion: 'q'\n        });\n        if (move === null) return 'snapback';\n        this.chess.undo();\n        this.squareSelected = target;\n        // check promotion\n        if (this.chess.get(source).type == 'p' && (target.charAt(1) == '8' || target.charAt(1) == '1')) {\n            this.promoteDialog().then(promotion => {\n                if (promotion) {\n                    this.registerMove(source, target, promotion);\n                }\n                this.board.position(this.chess.fen(), false);\n            });\n        } else {\n            this.registerMove(source, target, 'q');\n        }\n    };\n\n    private registerMove(source, target, promotion) {\n        this.chess.move({\n            from: source,\n            to: target,\n            promotion: promotion\n        });\n        if (this.configuration.playSounds) {\n            this.playAudio('move');\n        }\n        this.fenHistory.push(this.chess.fen());\n        this.playerMoved.emit();\n        this.initializing = false;\n        this.prepareMove();\n    }\n\n    private showHint(from, to, promotion, count) {\n        const self = this;\n        const currentFen = this.chess.fen();\n        if (this.configuration.playSounds) {\n            this.playAudio('move');\n        }\n        this.chess.move({ from: from, to: to, promotion: promotion });\n        this.board.position(this.chess.fen(), true);\n        setTimeout(function () {\n            self.chess.undo();\n            self.board.position(currentFen, true);\n            count--;\n            if (count >= 0) {\n                setTimeout(function () {\n                    self.showHint(from, to, promotion, count - 1);\n                }, 500);\n            } else {\n                self.hinting = false;\n                self.engineEndThinking.emit();\n            }\n        }, 500);\n    }\n\n    private onMoveEnd(source, target) {\n    };\n\n    private onMouseoutSquare(square, piece, position, orientation) {\n        this.removeGreySquares();\n    };\n\n    private onMouseoverSquare(square, piece, position, orientation) {\n        if (this.chess.turn() !== this.player) {\n            return;\n        }\n        if (this.squareSelected) {\n            this.onDrop(this.squareSelected, square, piece, null, null, orientation);\n            this.board.position(this.chess.fen(), false);\n            this.squareSelected = square;\n        } else if (piece) {\n            this.drawGreySquares(square);\n        }\n    };\n\n    private onSnapEnd(source, target, piece) {\n        this.highlightSquares(source, target);\n    };\n\n    private cleanHighlights() {\n        document.querySelectorAll('.highlight-square').forEach(square => {\n            square.classList.remove('highlight-square');\n        });\n    }\n\n    private highlightSquares(source, target) {\n        this.cleanHighlights();\n        document.querySelector('.square-' + source).classList.add('highlight-square');\n        document.querySelector('.square-' + target).classList.add('highlight-square');\n    }\n\n    private getStockfishMove() {\n        this.stockfish.postMessage('position fen ' + this.chess.fen());\n        this.stockfish.postMessage('go depth ' + this.configuration.stockfishDepth);\n    }\n\n    private getSyzygyMove() {\n        this.engineInfo.emit(this.literales['chessboard.querying-syzygy']);\n        this.http.get<any>(`http://tablebase.lichess.ovh/standard?fen=${this.chess.fen()}`)\n            .subscribe(data => {\n                if (this.initializing) {\n                    return;\n                }\n                const bestmove =\n                    data.moves[0].uci\n                    //('draw' === this.target ? data.moves[data.moves.length - 1].uci : data.moves[0].uci)\n                    ;\n                let match = bestmove.match(/^([a-h][1-8])([a-h][1-8])([qrbn])?/);\n                if (this.hinting) {\n                    if (data.dtm) {\n                        if (data.dtm > 0) {\n                            this.engineInfo.emit(this.literales['chessboard.mate-in'] + ' ' + Math.abs((data.dtm % 2 === 0 ? data.dtm : data.dtm + 1) / 2));\n                        } else {\n                            if (this.configuration.playSounds && !this.ooopsPlayed && !this.autosolve) {\n                                this.ooopsPlayed = true;\n                                this.playAudio('fail');\n                            }\n                            this.engineInfo.emit(this.literales['chessboard.receive-mate-in']);\n                        }\n                    } else {\n                        if ('checkmate' === this.target && this.configuration.playSounds && !this.ooopsPlayed && !this.autosolve) {\n                            this.ooopsPlayed = true;\n                            this.playAudio('fail');\n                        }\n                        this.engineInfo.emit(this.literales['chessboard.unfeasible-mate']);\n                    }\n                    this.showHint(match[1], match[2], match[3], 2);\n                    return;\n                }\n                if (this.configuration.playSounds) {\n                    this.playAudio('move');\n                }\n                this.chess.move({ from: match[1], to: match[2], promotion: match[3] });\n                this.board.position(this.chess.fen(), false);\n                if (this.originalPlayer !== this.player) {\n                    this.playerMoved.emit();\n                }\n                this.fenHistory.push(this.chess.fen());\n                this.highlightSquares(match[1], match[2]);\n                if (this.chess.game_over()) {\n                    let message;\n                    if (this.chess.in_checkmate())\n                        message = 'Checkmate';\n                    else if (this.chess.in_stalemate())\n                        message = this.literales['chessboard.stalemate'];\n                    else if (this.chess.insufficient_material())\n                        message = this.literales['chessboard.insufficent-material'];\n                    else if (this.chess.in_threefold_repetition())\n                        message = this.literales['chessboard.three-repetition'];\n                    else if (this.chess.in_draw())\n                        message = this.literales['chessboard.rule-fifty'];\n                    else\n                        message = this.literales['chessboard.game-over'];\n                    this.autosolve = false;\n                    this.fenPointer = this.fenHistory.length - 1;\n                    if (this.configuration.playSounds) {\n                        if ('checkmate' !== this.target && !this.chess.in_checkmate() ||\n                            'checkmate' === this.target && this.chess.in_checkmate() && this.originalPlayer !== this.chess.turn()) {\n                            this.playAudio('success');\n                        } else {\n                            this.playAudio('fail');\n                        }\n                    }\n                    this.gameOver.emit(message);\n                    return;\n                } else {\n                    if (data.dtm) {\n                        if (data.dtm < 0) {\n                            this.engineInfo.emit(this.literales['chessboard.mate-in'] + ' ' + Math.abs((data.dtm % 2 === 0 ? data.dtm : data.dtm + 1) / 2));\n                        } else {\n                            if (this.configuration.playSounds && !this.ooopsPlayed && !this.autosolve) {\n                                this.ooopsPlayed = true;\n                                this.playAudio('fail');\n                            }\n                            this.engineInfo.emit(this.literales['chessboard.receive-mate-in']);\n                        }\n                    } else {\n                        if ('checkmate' === this.target && this.configuration.playSounds && !this.ooopsPlayed && !this.autosolve) {\n                            this.ooopsPlayed = true;\n                            this.playAudio('fail');\n                        }\n                        this.engineInfo.emit(this.literales['chessboard.unfeasible-mate']);\n                    }\n                }\n                if (this.autosolve || this.player !== this.originalPlayer) {\n                    if (this.player === 'w') {\n                        this.player = 'b';\n                    } else {\n                        this.player = 'w';\n                    }\n                    this.prepareMove();\n                } else {\n                    if (this.squareSelected) {\n                        document.querySelector('.square-' + this.squareSelected).classList.add('highlight-square');\n                    }\n                    this.engineEndThinking.emit();\n                }\n            }, error => {\n                this.useSyzygy = false;\n                this.engineInfo.emit(this.literales['syzygy-error']);\n                this.getStockfishMove();\n            }\n            );\n    }\n\n    private numberOfPieces(fen) {\n        return fen.substring(0, fen.indexOf(\" \")).replace(/\\d/g, \"\").replace(/\\//g, \"\").length;\n    }\n\n    private getEngineMove() {\n        if (this.useSyzygy && this.numberOfPieces(this.chess.fen()) <= 7) {\n            this.getSyzygyMove();\n        } else {\n            this.getStockfishMove();\n        }\n    }\n\n    private prepareMove() {\n        if (!this.chess.game_over()) {\n            if (this.chess.turn() !== this.player) {\n                this.getEngineMove();\n                this.engineStartThinking.emit();\n            }\n        } else {\n            this.autosolve = false;\n            if (this.chess.game_over()) {\n                let message;\n                if (this.chess.in_checkmate())\n                    message = 'Checkmate';\n                else if (this.chess.in_stalemate())\n                    message = this.literales['chessboard.stalemate'];\n                else if (this.chess.insufficient_material())\n                    message = this.literales['chessboard.insufficent-material'];\n                else if (this.chess.in_threefold_repetition())\n                    message = this.literales['chessboard.three-repetition'];\n                else if (this.chess.in_draw())\n                    message = this.literales['chessboard.rule-fifty'];\n                else\n                    message = this.literales['chessboard.game-over'];\n                this.fenPointer = this.fenHistory.length - 1;\n                if (this.configuration.playSounds) {\n                    if ('checkmate' !== this.target && !this.chess.in_checkmate() ||\n                        'checkmate' === this.target && this.chess.in_checkmate() && this.originalPlayer !== this.chess.turn()) {\n                        this.playAudio('success');\n                    } else {\n                        this.playAudio('fail');\n                    }\n                }\n                this.gameOver.emit(message);\n                return;\n            }\n        }\n    }\n\n    private drawGreySquares(square) {\n        // get list of possible moves for this square\n        const moves = this.chess.moves({ square: square, verbose: true });\n        // exit if there are no moves available for this square\n        if (moves.length === 0) return;\n        //this.removeGreySquares();\n        // highlight the square they moused over\n        this.greySquare(square);\n        // highlight the possible squares for this piece\n        moves.forEach(move => {\n            this.greySquare(move.to);\n        });\n    }\n\n    private greySquare(square) {\n        const squareEl = $('#__chessboard__ .square-' + square);\n        /*\n        let background = 'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAANElEQVQYlWP4cHPrf0KYgZCCrR3J+BVt7UgmziScimAm4FSEroB067CZgKIIn4IPN7f+BwDVaRVpspCjIQAAAABJRU5ErkJggg==) repeat';\n        if (squareEl.hasClass('black-3c85d') === true) {\n            background = 'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAANElEQVQYlWPY2pH8nxBmIKTgw82t+BV9uLmVOJNwKoKZgFMRugLSrcNmAooifAq2diT/BwD7VtmENkc+eQAAAABJRU5ErkJggg==) repeat';\n        }\n        */\n        let background = '#e5d8c2'; // claro #f0d9b5\n        if (squareEl.hasClass('black-3c85d') === true) {\n            background = '#9d8b7b'; // oscuro #b58863\n        }\n\n        squareEl.css('background', background);\n    };\n\n    private removeGreySquares() {\n        $('#__chessboard__ .square-55d63').css('background', '');\n    };\n}\n","export * from './chessboard.component';\nexport * from './promotion.dialog';","module.exports = \"<ion-header>\\n    <ion-toolbar>\\n        <ion-title>{{'chessboard.promotion.title' | translate}}</ion-title>\\n    </ion-toolbar>\\n</ion-header>\\n<ion-content>\\n    <ion-grid>\\n        <ion-row>\\n            <ion-col>\\n                <ion-button (click)=\\\"select('q')\\\" color=\\\"light\\\" size=\\\"large\\\" expand=\\\"full\\\">\\n                    <img slot=\\\"start\\\" src=\\\"../../assets/icon/{{turn}}Q.png\\\" class=\\\"thumbnail\\\" />\\n                </ion-button>\\n            </ion-col>\\n            <ion-col>\\n                <ion-button (click)=\\\"select('n')\\\" color=\\\"light\\\" size=\\\"large\\\" expand=\\\"full\\\">\\n                    <img slot=\\\"start\\\" src=\\\"../../assets/icon/{{turn}}N.png\\\" class=\\\"thumbnail\\\" />\\n                </ion-button>\\n            </ion-col>\\n        </ion-row>\\n        <ion-row>\\n            <ion-col>\\n                <ion-button (click)=\\\"select('r')\\\" color=\\\"light\\\" size=\\\"large\\\" expand=\\\"full\\\">\\n                    <img slot=\\\"start\\\" src=\\\"../../assets/icon/{{turn}}R.png\\\" class=\\\"thumbnail\\\" />\\n                </ion-button>\\n            </ion-col>\\n            <ion-col>\\n                <ion-button (click)=\\\"select('b')\\\" color=\\\"light\\\" size=\\\"large\\\" expand=\\\"full\\\">\\n                    <img slot=\\\"start\\\" src=\\\"../../assets/icon/{{turn}}B.png\\\" class=\\\"thumbnail\\\" />\\n                </ion-button>\\n            </ion-col>\\n        </ion-row>\\n    </ion-grid>\\n</ion-content>\"","module.exports = \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL2NoZXNzYm9hcmQvcHJvbW90aW9uLmRpYWxvZy5zY3NzIn0= */\"","import { Component, Input } from '@angular/core';\nimport { ModalController } from '@ionic/angular';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'chessboard-promotion',\n  templateUrl: 'promotion.dialog.html',\n  styleUrls: ['promotion.dialog.scss'],\n})\nexport class PromotionDialog {\n\n  @Input() turn: string;\n\n  constructor(public modalController: ModalController, public translate: TranslateService) { }\n\n  select(piece) {\n    this.modalController.dismiss({piece: piece});\n  }\n  \n}\n","import { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport { SharedModule } from '../shared';\nimport { PositionPage } from './position.page';\nimport { ChessboardComponent } from '../chessboard';\nimport { PromotionDialog } from '../chessboard';\n\n@NgModule({\n  imports: [\n    SharedModule,\n    RouterModule.forChild([\n      {\n        path: '',\n        component: PositionPage\n      }\n    ])\n  ],\n  declarations: [PositionPage,ChessboardComponent,PromotionDialog],\n  entryComponents: [PromotionDialog]\n})\nexport class PositionPageModule {}\n","module.exports = \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button></ion-menu-button>\\n    </ion-buttons>\\n    <ion-buttons slot=\\\"start\\\" *ngIf=\\\"showNavPrev\\\" (click)=\\\"gotoPrev()\\\" class=\\\"\\\">\\n      <ion-button>\\n        <ion-icon slot=\\\"icon-only\\\" name=\\\"arrow-round-back\\\"></ion-icon>\\n      </ion-button>\\n    </ion-buttons>\\n    <ion-buttons slot=\\\"end\\\" *ngIf=\\\"showNavNext\\\" (click)=\\\"gotoNext()\\\" class=\\\"\\\">\\n      <ion-button>\\n        <ion-icon slot=\\\"icon-only\\\" name=\\\"arrow-round-forward\\\"></ion-icon>\\n      </ion-button>\\n    </ion-buttons>\\n    <ion-title text-center class=\\\"padding-0\\\" *ngIf=\\\"(subcategory$ | async) as subcategory\\\" [routerDirection]=\\\"'root'\\\"\\n      routerLink=\\\"/list/{{idxCategory}}/{{idxSubcategory}}\\\">\\n      <img *ngFor=\\\"let image of subcategory.images\\\" src=\\\"../../assets/icon/{{image}}\\\" class=\\\"responsive-thumbnail\\\" />\\n      &nbsp;<span class=\\\"responsive-text\\\">[ {{idxPosition + 1}} / {{idxLastPosition + 1}} ]</span>\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n<ion-content>\\n  <div class=\\\"container\\\">\\n    <div class=\\\"board_wrapper\\\" id=\\\"board-wrapper\\\">\\n      <chessboard #chessboard (engineReady)=\\\"onEngineReady()\\\" (engineStartThinking)=\\\"onEngineStartThinking()\\\"\\n        (engineEndThinking)=\\\"onEngineEndThinking()\\\" (engineInfo)=\\\"onEngineInfo($event)\\\" (playerMoved)=\\\"onPlayerMoved()\\\"\\n        (gameOver)=\\\"onGameOver($event)\\\">\\n      </chessboard>\\n    </div>\\n    <div class=\\\"info_wrapper\\\">\\n      <div class=\\\"info\\\">\\n        <div class=\\\"innerinfo\\\" *ngIf=\\\"(position$ | async) as position\\\">\\n          <p class=\\\"text-centered\\\">\\n            <img *ngIf=\\\"targetImage\\\" src=\\\"../../assets/icon/{{targetImage}}\\\" class=\\\"thumbnail\\\" />\\n            {{('position.' + position.move) | translate}} {{'position.to' | translate}}\\n            {{('position.' + position.target) | translate}}\\n          </p>\\n          <p *ngIf=\\\"engineThinking\\\" class=\\\"text-centered\\\">\\n            <ion-spinner name=\\\"dots\\\"></ion-spinner>\\n          </p>\\n          <p *ngIf=\\\"!engineThinking\\\" class=\\\"text-centered\\\">{{infotext}}</p>\\n          <p *ngIf=\\\"position.record > 0\\\" class=\\\"text-centered\\\">{{'position.personal-record' | translate}}:\\n            {{position.record}} {{'position.moves' | translate}}</p>\\n        </div>\\n      </div>\\n      <div class=\\\"action_buttons\\\">\\n        <ion-grid>\\n          <ion-row *ngIf=\\\"!engineThinking && !gameOver\\\">\\n            <ion-col>\\n              <ion-button [disabled]=\\\"!btnRewindEnabled\\\" (click)=\\\"btnRewindClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\"\\n                color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"rewind\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col>\\n              <ion-button [disabled]=\\\"!btnUndoEnabled\\\" (click)=\\\"btnUndoClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"skip-backward\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col>\\n              <ion-button [disabled]=\\\"!btnFlipEnabled\\\" (click)=\\\"btnFlipClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"sync\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col>\\n              <ion-button [disabled]=\\\"!btnSolveEnabled\\\" (click)=\\\"btnHintlick()\\\" size=\\\"small\\\" fill=\\\"clear\\\"\\n                color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"bulb\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col>\\n              <ion-button [disabled]=\\\"!btnSolveEnabled\\\" (click)=\\\"btnSolveClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\"\\n                color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"color-wand\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n          </ion-row>\\n          <ion-row *ngIf=\\\"engineThinking && !gameOver\\\">\\n            <ion-col>\\n              <ion-button (click)=\\\"btnStopEngineClick()\\\" size=\\\"small\\\" expand=\\\"full\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"square\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n          </ion-row>\\n          <ion-row *ngIf=\\\"gameOver\\\">\\n            <ion-col size=\\\"2\\\">\\n              <ion-button [disabled]=\\\"autoplaying || chessboard.isShowingFirstPosition()\\\"\\n                (click)=\\\"btnShowFirstPositionClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"rewind\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col size=\\\"2\\\">\\n              <ion-button [disabled]=\\\"autoplaying || chessboard.isShowingFirstPosition()\\\"\\n                (click)=\\\"btnShowPreviousPositionClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"skip-backward\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col size=\\\"2\\\">\\n              <ion-button *ngIf=\\\"!autoplaying\\\" [disabled]=\\\"chessboard.isShowingLatestPosition()\\\"\\n                (click)=\\\"btnPlayClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"play\\\"></ion-icon>\\n              </ion-button>\\n              <ion-button *ngIf=\\\"autoplaying\\\" (click)=\\\"btnPauseClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"pause\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col size=\\\"2\\\">\\n              <ion-button [disabled]=\\\"autoplaying || chessboard.isShowingLatestPosition()\\\"\\n                (click)=\\\"btnShowNextPositionClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"skip-forward\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col size=\\\"2\\\">\\n              <ion-button [disabled]=\\\"autoplaying || chessboard.isShowingLatestPosition()\\\"\\n                (click)=\\\"btnShowLatestPositionClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"fastforward\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n            <ion-col size=\\\"2\\\">\\n              <ion-button [disabled]=\\\"autoplaying\\\" (click)=\\\"btnRewindClick()\\\" size=\\\"small\\\" fill=\\\"clear\\\" color=\\\"dark\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"trash\\\"></ion-icon>\\n              </ion-button>\\n            </ion-col>\\n          </ion-row>\\n        </ion-grid>\\n      </div>\\n    </div>\\n  </div>\\n</ion-content>\"","module.exports = \"@media (max-width: 500px) {\\n  .hideOnSmallWidth {\\n    display: none !important; } }\\n\\n@media (min-width: 500px) {\\n  .showOnSmallWidth {\\n    display: none !important; } }\\n\\n.container {\\n  width: 100%;\\n  height: 100%;\\n  overflow: hidden; }\\n\\n.board_wrapper {\\n  float: left;\\n  padding-left: 2px; }\\n\\n.info_wrapper {\\n  float: left;\\n  /*float: right;*/ }\\n\\n.info {\\n  width: 100%;\\n  display: table;\\n  height: calc(100% - 52px); }\\n\\n.innerinfo {\\n  display: table-cell;\\n  vertical-align: middle; }\\n\\n.action_buttons {\\n  width: 100%;\\n  height: 48px; }\\n\\n.padding-0 {\\n  padding-left: 0;\\n  padding-right: 0; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yYXZpdmFsbHVyaS9EZXNrdG9wL2NoZXNzR2FtZS9zcmMvYXBwL3Bvc2l0aW9uL3Bvc2l0aW9uLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDSTtFQURKO0lBRVEsd0JBQXdCLEVBQUEsRUFFL0I7O0FBRUc7RUFESjtJQUVRLHdCQUF3QixFQUFBLEVBRS9COztBQUNEO0VBQ0ksV0FBVztFQUNYLFlBQVk7RUFDWixnQkFBZ0IsRUFBQTs7QUFFcEI7RUFDSSxXQUFXO0VBQ1gsaUJBQWlCLEVBQUE7O0FBRXJCO0VBQ0ksV0FBVztFQUNYLGdCQUFBLEVBQWlCOztBQUVyQjtFQUNJLFdBQVc7RUFDWCxjQUFjO0VBQ2QseUJBQXlCLEVBQUE7O0FBRTdCO0VBQ0ksbUJBQW1CO0VBQ25CLHNCQUFzQixFQUFBOztBQUUxQjtFQUNJLFdBQVc7RUFDWCxZQUFZLEVBQUE7O0FBRWhCO0VBQ0ksZUFBZTtFQUNmLGdCQUFnQixFQUFBIiwiZmlsZSI6InNyYy9hcHAvcG9zaXRpb24vcG9zaXRpb24ucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmhpZGVPblNtYWxsV2lkdGgge1xuICAgIEBtZWRpYSAobWF4LXdpZHRoOiA1MDBweCkge1xuICAgICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7XG4gICAgfVxufVxuLnNob3dPblNtYWxsV2lkdGgge1xuICAgIEBtZWRpYSAobWluLXdpZHRoOiA1MDBweCkge1xuICAgICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7XG4gICAgfVxufVxuLmNvbnRhaW5lciB7XG4gICAgd2lkdGg6IDEwMCU7XG4gICAgaGVpZ2h0OiAxMDAlO1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG59XG4uYm9hcmRfd3JhcHBlciB7XG4gICAgZmxvYXQ6IGxlZnQ7XG4gICAgcGFkZGluZy1sZWZ0OiAycHg7XG59XG4uaW5mb193cmFwcGVyIHtcbiAgICBmbG9hdDogbGVmdDtcbiAgICAvKmZsb2F0OiByaWdodDsqL1xufVxuLmluZm8ge1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIGRpc3BsYXk6IHRhYmxlO1xuICAgIGhlaWdodDogY2FsYygxMDAlIC0gNTJweCk7XG59XG4uaW5uZXJpbmZvIHtcbiAgICBkaXNwbGF5OiB0YWJsZS1jZWxsO1xuICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG59XG4uYWN0aW9uX2J1dHRvbnMge1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIGhlaWdodDogNDhweDtcbn1cbi5wYWRkaW5nLTAge1xuICAgIHBhZGRpbmctbGVmdDogMDtcbiAgICBwYWRkaW5nLXJpZ2h0OiAwO1xufVxuIl19 */\"","import { Component, OnInit, ViewChild, HostListener, OnDestroy } from '@angular/core';\nimport { Location } from '@angular/common';\nimport { ActivatedRoute } from '@angular/router';\nimport { Insomnia } from '@ionic-native/insomnia/ngx';\nimport { EndgameDatabaseService, EndgameDatabase, Category, Subcategory, Position, MiscService, ConfigurationService, Configuration } from '../shared';\nimport { Observable, of } from 'rxjs';\nimport { AlertController, MenuController } from '@ionic/angular';\nimport { TranslateService } from '@ngx-translate/core';\nimport { ChessboardComponent } from '../chessboard';\n\n@Component({\n  selector: 'app-position',\n  templateUrl: 'position.page.html',\n  styleUrls: ['position.page.scss']\n})\nexport class PositionPage implements OnInit, OnDestroy {\n\n  private configuration: Configuration;\n  public endgameDatabase: EndgameDatabase;\n  public idxCategory: number;\n  public idxSubcategory: number;\n  public idxPosition: number;\n  public idxLastSubcategory: number;\n  public idxLastPosition: number;\n  public showNavPrev = false;\n  public showNavNext = false;\n  public category$: Observable<Category>;\n  public subcategory$: Observable<Subcategory>;\n  public position$: Observable<Position>;\n  public category: Category;\n  public subcategory: Subcategory;\n  public position: Position;\n  public idx = 1;\n  public targetImage = '';\n  public infotext = '';\n  public btnRewindEnabled = false;\n  public btnUndoEnabled = false;\n  public btnFlipEnabled = false;\n  public btnSolveEnabled = false;\n  public autosolve = false;\n  public autosolveUsed = false;\n  public engineThinking = false;\n  public gameOver = false;\n  public autoplaying = false;\n  public intervalPlay;\n  public literales: any;\n\n  @ViewChild('chessboard') chessboard: ChessboardComponent;\n\n  constructor(\n    private route: ActivatedRoute,\n    private location: Location,\n    private menuController: MenuController,\n    public alertController: AlertController,\n    public translate: TranslateService,\n    private configurationService: ConfigurationService,\n    private endgameDatabaseService: EndgameDatabaseService,\n    private miscService: MiscService,\n    private insomnia: Insomnia) {\n  }\n\n  ngOnInit() {\n    this.route.params.subscribe(params => {\n      this.idxCategory = +params.idxcategory;\n      this.idxSubcategory = +params.idxsubcategory;\n      this.idxPosition = +params.idxposition;\n      this.endgameDatabaseService.initialize().then(result => {\n        this.endgameDatabase = this.endgameDatabaseService.getDatabase();\n        this.load();\n      });\n    });\n  }\n\n  ionViewWillEnter() {\n    this.configurationService.initialize().then(config => {\n      this.configuration = config;\n      if (config.preventScreenOff) {\n        this.insomnia.keepAwake();\n      }\n    });\n    this.menuController.get('mainMenu').then(function (menu) {\n      menu.swipeGesture = false;\n    });\n  }\n\n  ionViewWillLeave() {\n    if (this.configuration && this.configuration.preventScreenOff) {\n      this.insomnia.allowSleepAgain();\n    }\n    this.stopAutoplay();\n    this.menuController.get('mainMenu').then(function (menu) {\n      menu.swipeGesture = true;\n    });\n  }\n\n  ngOnDestroy() {\n  }\n\n  @HostListener('window:resize', ['$event'])\n  onResize(event) {\n    const container = document.querySelector('.container');\n    const boardWrapper: any = document.querySelector('.board_wrapper');\n    const infoWrapper: any = document.querySelector('.info_wrapper');\n    const containerWidth = container.clientWidth;\n    const containerHeight = container.clientHeight;\n    const minSize = Math.min(containerWidth, containerHeight);\n    boardWrapper.style.height = minSize + 'px';\n    boardWrapper.style.width = minSize + 'px';\n    if (containerWidth > containerHeight) {\n      infoWrapper.style.width = containerWidth - minSize - 2 + 'px';\n      infoWrapper.style.height = '100%';\n    } else {\n      infoWrapper.style.width = '100%';\n      infoWrapper.style.height = containerHeight - minSize - 2 + 'px';\n    }\n  }\n\n  load() {\n    this.category = this.endgameDatabase.categories[this.idxCategory];\n    this.subcategory = this.category.subcategories[this.idxSubcategory];\n    this.position = this.subcategory.games[this.idxPosition];\n    this.subcategory.images = this.miscService.textToImages(this.subcategory.name);\n    this.category$ = of(this.category);\n    this.subcategory$ = of(this.subcategory);\n    this.position$ = of(this.position);\n    this.idxLastSubcategory = this.endgameDatabase.categories[this.idxCategory].subcategories.length - 1;\n    this.idxLastPosition = this.endgameDatabase.categories[this.idxCategory].subcategories[this.idxSubcategory].games.length - 1;\n    this.showNavPrev = this.idxSubcategory > 0 || this.idxCategory > 0 || this.idxPosition > 0;\n    this.showNavNext = !(this.idxCategory === this.endgameDatabase.categories.length - 1\n      && this.idxSubcategory === this.idxLastSubcategory\n      && this.idxPosition === this.idxLastPosition);\n    if ('white' === this.position.move) {\n      this.targetImage = 'wK.png';\n    } else {\n      this.targetImage = 'bK.png';\n    }\n    this.chessboard.build(this.position.fen, this.position.target);\n    this.engineThinking = false;\n    this.gameOver = false;\n    this.btnRewindEnabled = false;\n    this.btnUndoEnabled = false;\n    this.btnFlipEnabled = true;\n    this.btnSolveEnabled = true;\n    this.translate.get([\n      'position.your-turn',\n      'position.used-assistance',\n      'position.new-record',\n      'position.goal-achieved',\n      'position.congratulations',\n      'position.review',\n      'position.next-puzzle',\n      'position.in',\n      'position.moves',\n      'position.ups',\n      'position.keep-practicing',\n      'position.ok'\n    ]).subscribe(async res => {\n      this.literales = res;\n      this.infotext = this.literales['position.your-turn'];\n    });\n  }\n\n  onEngineReady() {\n\n  }\n\n  onEngineStartThinking() {\n    this.engineThinking = true;\n  }\n\n  onEngineEndThinking() {\n    this.engineThinking = false;\n    if (this.infotext !== this.literales['position.your-turn'])\n      this.infotext += ' : ' + this.literales['position.your-turn'];\n  }\n\n  onEngineInfo(info) {\n    this.infotext = info;\n  }\n\n  onPlayerMoved() {\n    this.btnRewindEnabled = true;\n    this.btnUndoEnabled = true;\n  }\n\n  async onGameOver(message) {\n    this.engineThinking = false;\n    this.infotext = message;\n    this.gameOver = true;\n    let header, subHeader, text;\n    if (this.autosolve) {\n      this.autosolve = false;\n      return;\n    }\n    let buttons;\n    if ((message === 'Checkmate' && this.chessboard.winner() === this.position.move) || (this.position.target !== 'checkmate' && message !== 'Checkmate')) {\n      const totalMoves = this.chessboard.history().length;\n      let playerMoves;\n      if (totalMoves % 2 === 0) {\n        playerMoves = totalMoves / 2;\n      } else {\n        playerMoves = (totalMoves + 1) / 2;\n      }\n      if (this.autosolveUsed) {\n        header = this.literales['position.used-assistance'];\n        buttons = [{\n          test: this.literales['position.ok'],\n          cssClass: 'overlay-button'\n        }];\n      } else {\n        if (!this.position.record || this.position.record < 0 || playerMoves < this.position.record) {\n          subHeader = this.literales['position.new-record']\n          this.position.record = playerMoves;\n          this.endgameDatabaseService.saveDatabase();\n        } else {\n          subHeader = this.literales['position.goal-achieved'];\n        }\n        header = this.literales['position.congratulations'];\n        if (this.showNavNext) {\n          buttons = [\n            {\n              text: this.literales['position.review'],\n              cssClass: 'overlay-button'\n            },\n            {\n              text: this.literales['position.next-puzzle'],\n              cssClass: 'overlay-button',\n              handler: () => { this.gotoNext(); }\n            }\n          ];\n        } else {\n          buttons = [{\n            text: this.literales['position.ok'],\n            cssClass: 'overlay-button'\n          }];\n        }\n      }\n      text = this.infotext + ' ' + this.literales['position.in'] + ' ' + playerMoves + ' ' + this.literales['position.moves'];\n    } else {\n      if (!this.position.record) {\n        this.position.record = -1;\n        this.endgameDatabaseService.saveDatabase();\n      }\n      header = this.literales['position.ups'];\n      subHeader = message;\n      text = this.literales['position.keep-practicing'];\n      buttons = [{\n        text: this.literales['position.ok'],\n        cssClass: 'overlay-button'\n      }];\n    }\n    const alert = await this.alertController.create({\n      header: header,\n      subHeader: subHeader,\n      message: text,\n      buttons: buttons\n    });\n    await alert.present();\n  }\n\n  btnRewindClick() {\n    this.chessboard.rewind();\n    this.autosolveUsed = false;\n    this.btnRewindEnabled = false;\n    this.btnUndoEnabled = false;\n    this.gameOver = false;\n    this.infotext = this.literales['position.your-turn'];\n  }\n\n  btnUndoClick() {\n    this.chessboard.undo();\n    const history = this.chessboard.history();\n    this.btnRewindEnabled = history.length > 0;\n    this.btnUndoEnabled = this.btnRewindEnabled;\n    this.infotext = this.literales['position.your-turn'];\n  }\n\n  btnFlipClick() {\n    this.chessboard.flip();\n  }\n\n  btnSolveClick() {\n    this.autosolve = true;\n    this.autosolveUsed = true;\n    this.chessboard.solve();\n  }\n\n  btnHintlick() {\n    this.autosolveUsed = true;\n    this.chessboard.hint();\n  }\n\n  btnStopEngineClick() {\n    this.chessboard.stop();\n    if (this.autosolve) {\n      this.autosolve = false;\n    }\n  }\n\n  btnShowFirstPositionClick() {\n    this.chessboard.showFirstPosition();\n  }\n\n  btnShowPreviousPositionClick() {\n    this.chessboard.showPreviousPosition();\n  }\n\n  btnShowNextPositionClick() {\n    this.chessboard.showNextPosition();\n  }\n\n  btnShowLatestPositionClick() {\n    this.chessboard.showLatestPosition();\n  }\n\n  btnPlayClick() {\n    const self = this;\n    this.autoplaying = true;\n    if (this.internalPlay()) {\n      this.intervalPlay = setInterval(function () {\n        if (!self.internalPlay()) {\n          clearInterval(self.intervalPlay);\n          self.intervalPlay = null;\n        }\n      }, 1000);\n    }\n  }\n\n  internalPlay() {\n    this.chessboard.showNextPosition();\n    if (this.chessboard.isShowingLatestPosition()) {\n      this.autoplaying = false;\n      return false;\n    }\n    return true;\n  }\n\n  btnPauseClick() {\n    this.autoplaying = false;\n    clearInterval(this.intervalPlay);\n  }\n\n  private stopAutoplay() {\n    if (this.intervalPlay) {\n      clearInterval(this.intervalPlay);\n      this.intervalPlay = null;\n      this.autoplaying = false;\n    }\n  }\n\n  gotoPrev() {\n    this.stopAutoplay();\n    let idxCat = this.idxCategory;\n    let idxSub = this.idxSubcategory;\n    let idxPos = this.idxPosition - 1;\n    if (idxPos < 0) {\n      idxSub--;\n      if (idxSub < 0) {\n        idxCat--;\n        idxSub = this.endgameDatabase.categories[idxCat].subcategories.length - 1;\n      }\n      idxPos = this.endgameDatabase.categories[idxCat].subcategories[idxSub].games.length - 1;\n    }\n    //this.navCtrl.navigateRoot('/position/'+ idxCat + '/' + idxSub + '/' + idxPos);\n    this.idxCategory = idxCat;\n    this.idxSubcategory = idxSub;\n    this.idxPosition = idxPos;\n    this.location.go('/position/' + idxCat + '/' + idxSub + '/' + idxPos);\n    this.load();\n  }\n\n  gotoNext() {\n    this.stopAutoplay();\n    let idxCat = this.idxCategory;\n    let idxSub = this.idxSubcategory;\n    let idxPos = this.idxPosition + 1;\n    if (idxPos > this.idxLastPosition) {\n      idxSub++;\n      if (idxSub > this.idxLastSubcategory) {\n        idxCat++;\n        idxSub = 0;\n      }\n      idxPos = 0;\n    }\n    //this.navCtrl.navigateRoot('/position/'+ idxCat + '/' + idxSub + '/' + idxPos);\n    this.idxCategory = idxCat;\n    this.idxSubcategory = idxSub;\n    this.idxPosition = idxPos;\n    this.location.go('/position/' + idxCat + '/' + idxSub + '/' + idxPos);\n    this.load();\n  }\n\n}\n"],"sourceRoot":""}